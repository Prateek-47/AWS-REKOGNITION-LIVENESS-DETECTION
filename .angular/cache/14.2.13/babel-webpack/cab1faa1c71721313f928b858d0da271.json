{"ast":null,"code":"import { __awaiter as t } from \"tslib\";\nimport * as e from \"@tensorflow/tfjs-core\";\nimport * as o from \"@tensorflow-models/blazeface\";\nimport * as s from \"@tensorflow/tfjs-backend-wasm\";\nimport \"@tensorflow/tfjs-backend-cpu\";\nimport { jitteredExponentialRetry as a } from \"@aws-amplify/core\";\nimport { isWebAssemblySupported as r } from \"./support.mjs\";\nimport { FaceDetection as i } from \"../types/faceDetection.mjs\";\nimport \"../types/liveness.mjs\";\nimport \"../types/error.mjs\";\n\nclass n extends i {\n  constructor(t, e) {\n    super(), this.faceModelUrl = e, this.binaryPath = null != t ? t : `https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@${s.version_wasm}/dist/`;\n  }\n\n  loadModels() {\n    return t(this, void 0, void 0, function* () {\n      r() ? yield this._loadWebAssemblyBackend() : yield this._loadCPUBackend();\n\n      try {\n        yield e.ready(), this._model = yield a(o.load, [{\n          modelUrl: this.faceModelUrl\n        }]);\n      } catch (t) {\n        throw new Error(\"There was an error loading the blazeface model. If you are using a custom blazeface model url ensure that it is a fully qualified url that returns a json file.\");\n      }\n    });\n  }\n\n  detectFaces(e) {\n    return t(this, void 0, void 0, function* () {\n      const t = yield this._model.estimateFaces(e, !1, !0, !0),\n            o = Date.now();\n      return t.filter(t => !!t.landmarks).map(t => {\n        const {\n          topLeft: e,\n          bottomRight: s,\n          probability: a,\n          landmarks: r\n        } = t,\n              [i, n] = e,\n              [l, d] = s,\n              m = Math.abs(i - l),\n              c = Math.abs(d - n),\n              f = r[0],\n              h = r[1],\n              u = r[2],\n              p = r[3];\n        return {\n          top: n,\n          left: l,\n          width: m,\n          height: c,\n          timestampMs: o,\n          probability: a[0],\n          rightEye: f,\n          leftEye: h,\n          mouth: p,\n          nose: u\n        };\n      });\n    });\n  }\n\n  _loadWebAssemblyBackend() {\n    return t(this, void 0, void 0, function* () {\n      try {\n        s.setWasmPaths(this.binaryPath), yield a(() => t(this, void 0, void 0, function* () {\n          if (!(yield e.setBackend(\"wasm\"))) throw new Error(\"Initialization of backend wasm failed\");\n        }), []), this.modelBackend = \"wasm\";\n      } catch (t) {\n        throw new Error('There was an error loading the TFJS WASM backend. If you are using a custom WASM path ensure that it ends with \"/\" and that it is not the full URL as @tensorflow/tfjs-backend-wasm will append the wasm binary file name. Read more: https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/src/backend_wasm.ts#L475.');\n      }\n    });\n  }\n\n  _loadCPUBackend() {\n    return t(this, void 0, void 0, function* () {\n      yield e.setBackend(\"cpu\"), this.modelBackend = \"cpu\";\n    });\n  }\n\n}\n\nexport { n as BlazeFaceFaceDetection };","map":{"version":3,"names":["__awaiter","t","e","o","s","jitteredExponentialRetry","a","isWebAssemblySupported","r","FaceDetection","i","n","constructor","faceModelUrl","binaryPath","version_wasm","loadModels","_loadWebAssemblyBackend","_loadCPUBackend","ready","_model","load","modelUrl","Error","detectFaces","estimateFaces","Date","now","filter","landmarks","map","topLeft","bottomRight","probability","l","d","m","Math","abs","c","f","h","u","p","top","left","width","height","timestampMs","rightEye","leftEye","mouth","nose","setWasmPaths","setBackend","modelBackend","BlazeFaceFaceDetection"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/@aws-amplify/ui-react-liveness/dist/esm/components/FaceLivenessDetector/service/utils/blazefaceFaceDetection.mjs"],"sourcesContent":["import{__awaiter as t}from\"tslib\";import*as e from\"@tensorflow/tfjs-core\";import*as o from\"@tensorflow-models/blazeface\";import*as s from\"@tensorflow/tfjs-backend-wasm\";import\"@tensorflow/tfjs-backend-cpu\";import{jitteredExponentialRetry as a}from\"@aws-amplify/core\";import{isWebAssemblySupported as r}from\"./support.mjs\";import{FaceDetection as i}from\"../types/faceDetection.mjs\";import\"../types/liveness.mjs\";import\"../types/error.mjs\";class n extends i{constructor(t,e){super(),this.faceModelUrl=e,this.binaryPath=null!=t?t:`https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@${s.version_wasm}/dist/`}loadModels(){return t(this,void 0,void 0,(function*(){r()?yield this._loadWebAssemblyBackend():yield this._loadCPUBackend();try{yield e.ready(),this._model=yield a(o.load,[{modelUrl:this.faceModelUrl}])}catch(t){throw new Error(\"There was an error loading the blazeface model. If you are using a custom blazeface model url ensure that it is a fully qualified url that returns a json file.\")}}))}detectFaces(e){return t(this,void 0,void 0,(function*(){const t=yield this._model.estimateFaces(e,!1,!0,!0),o=Date.now();return t.filter((t=>!!t.landmarks)).map((t=>{const{topLeft:e,bottomRight:s,probability:a,landmarks:r}=t,[i,n]=e,[l,d]=s,m=Math.abs(i-l),c=Math.abs(d-n),f=r[0],h=r[1],u=r[2],p=r[3];return{top:n,left:l,width:m,height:c,timestampMs:o,probability:a[0],rightEye:f,leftEye:h,mouth:p,nose:u}}))}))}_loadWebAssemblyBackend(){return t(this,void 0,void 0,(function*(){try{s.setWasmPaths(this.binaryPath),yield a((()=>t(this,void 0,void 0,(function*(){if(!(yield e.setBackend(\"wasm\")))throw new Error(\"Initialization of backend wasm failed\")}))),[]),this.modelBackend=\"wasm\"}catch(t){throw new Error('There was an error loading the TFJS WASM backend. If you are using a custom WASM path ensure that it ends with \"/\" and that it is not the full URL as @tensorflow/tfjs-backend-wasm will append the wasm binary file name. Read more: https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/src/backend_wasm.ts#L475.')}}))}_loadCPUBackend(){return t(this,void 0,void 0,(function*(){yield e.setBackend(\"cpu\"),this.modelBackend=\"cpu\"}))}}export{n as BlazeFaceFaceDetection};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}