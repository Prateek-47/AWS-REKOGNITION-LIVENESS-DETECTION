{"ast":null,"code":"import { __awaiter, __generator, __read, __spread, __values } from \"tslib\";\nimport { OpType } from '../types';\nimport { getIdentifierValue } from './utils'; // https://github.com/aws-amplify/amplify-js/blob/datastore-docs/packages/datastore/docs/sync-engine.md#merger\n\nvar ModelMerger =\n/** @class */\nfunction () {\n  function ModelMerger(outbox, ownSymbol) {\n    this.outbox = outbox;\n    this.ownSymbol = ownSymbol;\n  }\n  /**\n   *\n   * @param storage Storage adapter that contains the data.\n   * @param model The model from an outbox mutation.\n   * @returns The type of operation (INSERT/UPDATE/DELETE)\n   */\n\n\n  ModelMerger.prototype.merge = function (storage, model, modelDefinition) {\n    return __awaiter(this, void 0, void 0, function () {\n      var result, mutationsForModel, isDelete;\n\n      var _a, _b;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.outbox.getForModel(storage, model, modelDefinition)];\n\n          case 1:\n            mutationsForModel = _c.sent();\n            isDelete = model._deleted;\n            if (!(mutationsForModel.length === 0)) return [3\n            /*break*/\n            , 5];\n            if (!isDelete) return [3\n            /*break*/\n            , 3];\n            result = OpType.DELETE;\n            return [4\n            /*yield*/\n            , storage.delete(model, undefined, this.ownSymbol)];\n\n          case 2:\n            _c.sent();\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            return [4\n            /*yield*/\n            , storage.save(model, undefined, this.ownSymbol)];\n\n          case 4:\n            _a = __read.apply(void 0, [_c.sent(), 1]), _b = __read(_a[0], 2), result = _b[1];\n            _c.label = 5;\n\n          case 5:\n            return [2\n            /*return*/\n            , result];\n        }\n      });\n    });\n  };\n\n  ModelMerger.prototype.mergePage = function (storage, modelConstructor, items, modelDefinition) {\n    return __awaiter(this, void 0, void 0, function () {\n      var itemsMap, items_1, items_1_1, item, modelId, page;\n\n      var e_1, _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            itemsMap = new Map();\n\n            try {\n              for (items_1 = __values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n                item = items_1_1.value;\n                modelId = getIdentifierValue(modelDefinition, item);\n                itemsMap.set(modelId, item);\n              }\n            } catch (e_1_1) {\n              e_1 = {\n                error: e_1_1\n              };\n            } finally {\n              try {\n                if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n              } finally {\n                if (e_1) throw e_1.error;\n              }\n            }\n\n            page = __spread(itemsMap.values());\n            return [4\n            /*yield*/\n            , storage.batchSave(modelConstructor, page, this.ownSymbol)];\n\n          case 1:\n            return [2\n            /*return*/\n            , _b.sent()];\n        }\n      });\n    });\n  };\n\n  return ModelMerger;\n}();\n\nexport { ModelMerger };","map":{"version":3,"names":["__awaiter","__generator","__read","__spread","__values","OpType","getIdentifierValue","ModelMerger","outbox","ownSymbol","prototype","merge","storage","model","modelDefinition","result","mutationsForModel","isDelete","_a","_b","_c","label","getForModel","sent","_deleted","length","DELETE","delete","undefined","save","apply","mergePage","modelConstructor","items","itemsMap","items_1","items_1_1","item","modelId","page","e_1","Map","next","done","value","set","e_1_1","error","return","call","values","batchSave"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/@aws-amplify/datastore/lib-esm/sync/merger.js"],"sourcesContent":["import { __awaiter, __generator, __read, __spread, __values } from \"tslib\";\nimport { OpType, } from '../types';\nimport { getIdentifierValue } from './utils';\n// https://github.com/aws-amplify/amplify-js/blob/datastore-docs/packages/datastore/docs/sync-engine.md#merger\nvar ModelMerger = /** @class */ (function () {\n    function ModelMerger(outbox, ownSymbol) {\n        this.outbox = outbox;\n        this.ownSymbol = ownSymbol;\n    }\n    /**\n     *\n     * @param storage Storage adapter that contains the data.\n     * @param model The model from an outbox mutation.\n     * @returns The type of operation (INSERT/UPDATE/DELETE)\n     */\n    ModelMerger.prototype.merge = function (storage, model, modelDefinition) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result, mutationsForModel, isDelete;\n            var _a, _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.outbox.getForModel(storage, model, modelDefinition)];\n                    case 1:\n                        mutationsForModel = _c.sent();\n                        isDelete = model._deleted;\n                        if (!(mutationsForModel.length === 0)) return [3 /*break*/, 5];\n                        if (!isDelete) return [3 /*break*/, 3];\n                        result = OpType.DELETE;\n                        return [4 /*yield*/, storage.delete(model, undefined, this.ownSymbol)];\n                    case 2:\n                        _c.sent();\n                        return [3 /*break*/, 5];\n                    case 3: return [4 /*yield*/, storage.save(model, undefined, this.ownSymbol)];\n                    case 4:\n                        _a = __read.apply(void 0, [_c.sent(), 1]), _b = __read(_a[0], 2), result = _b[1];\n                        _c.label = 5;\n                    case 5: return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    ModelMerger.prototype.mergePage = function (storage, modelConstructor, items, modelDefinition) {\n        return __awaiter(this, void 0, void 0, function () {\n            var itemsMap, items_1, items_1_1, item, modelId, page;\n            var e_1, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        itemsMap = new Map();\n                        try {\n                            for (items_1 = __values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n                                item = items_1_1.value;\n                                modelId = getIdentifierValue(modelDefinition, item);\n                                itemsMap.set(modelId, item);\n                            }\n                        }\n                        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                        finally {\n                            try {\n                                if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n                            }\n                            finally { if (e_1) throw e_1.error; }\n                        }\n                        page = __spread(itemsMap.values());\n                        return [4 /*yield*/, storage.batchSave(modelConstructor, page, this.ownSymbol)];\n                    case 1: return [2 /*return*/, _b.sent()];\n                }\n            });\n        });\n    };\n    return ModelMerger;\n}());\nexport { ModelMerger };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}