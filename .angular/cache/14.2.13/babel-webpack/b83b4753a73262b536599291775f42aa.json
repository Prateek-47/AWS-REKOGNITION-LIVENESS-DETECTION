{"ast":null,"code":"import { __awaiter as e } from \"tslib\";\nimport { fillOverlayCanvasFractional as r, getRGBArrayFromColorString as o } from \"./liveness.mjs\";\nvar t;\n!function (e) {\n  e.SCROLLING = \"SCROLLING\", e.FLAT = \"FLAT\";\n}(t || (t = {}));\n\nclass s {\n  constructor(e, r) {\n    this.context = e, this.freshnessColorsSequence = r, this.isFirstTick = !0;\n  }\n\n  displayColorTick() {\n    return e(this, void 0, void 0, function* () {\n      return new Promise((e, r) => {\n        setTimeout(() => {\n          this.displayNextColorTick(e, r);\n        }, Math.min(10));\n      });\n    });\n  }\n\n  init() {\n    this.stageIndex = 0, this.currColorIndex = 0, this.currColorSequence = this.freshnessColorsSequence[0], this.prevColorSequence = this.freshnessColorsSequence[0], this.stage = t.FLAT, this.timeLastFlatOrScrollChange = Date.now(), this.timeLastFaceMatchChecked = Date.now();\n  }\n\n  displayNextColorTick(e, o) {\n    const {\n      freshnessColorEl: s\n    } = this.context.freshnessColorAssociatedParams,\n          {\n      ovalDetails: i,\n      scaleFactor: l\n    } = this.context.ovalAssociatedParams,\n          {\n      videoEl: n\n    } = this.context.videoAssociatedParams,\n          c = Date.now();\n    this.isFirstTick && (this.init(), this.isFirstTick = !1, this.sendColorStartTime({\n      tickStartTime: c,\n      currColor: this.currColorSequence.color,\n      prevColor: this.currColorSequence.color,\n      currColorIndex: this.stageIndex\n    }));\n    let a = c - this.timeLastFlatOrScrollChange;\n\n    if (s.style.display = \"block\", (this.stage === t.FLAT && a >= this.currColorSequence.flatDisplayDuration || this.stage === t.SCROLLING && a >= this.currColorSequence.downscrollDuration) && (this.incrementStageIndex(c), a = 0), this.currColorIndex < this.freshnessColorsSequence.length) {\n      const o = a / (this.stage === t.SCROLLING ? this.currColorSequence.downscrollDuration : this.currColorSequence.flatDisplayDuration);\n      r({\n        overlayCanvas: s,\n        prevColor: this.prevColorSequence.color,\n        nextColor: this.currColorSequence.color,\n        videoEl: n,\n        ovalDetails: i,\n        heightFraction: o,\n        scaleFactor: l\n      }), e(!1);\n    } else s.style.display = \"none\", e(!0);\n  }\n\n  incrementStageIndex(e) {\n    if (this.stageIndex += 1, this.prevColorSequence = this.freshnessColorsSequence[this.currColorIndex], this.stage === t.FLAT) this.currColorIndex += 1, this.stage = t.SCROLLING;else if (this.stage === t.SCROLLING) {\n      this.freshnessColorsSequence[this.currColorIndex].flatDisplayDuration > 0 ? this.stage = t.FLAT : (this.stage = t.SCROLLING, this.currColorIndex += 1);\n    }\n    this.currColorSequence = this.freshnessColorsSequence[this.currColorIndex], this.timeLastFlatOrScrollChange = Date.now(), this.currColorSequence && this.sendColorStartTime({\n      tickStartTime: e,\n      currColor: this.currColorSequence.color,\n      prevColor: this.prevColorSequence.color,\n      currColorIndex: this.stageIndex\n    });\n  }\n\n  sendColorStartTime({\n    tickStartTime: e,\n    currColor: r,\n    prevColor: t,\n    currColorIndex: s\n  }) {\n    const {\n      livenessStreamProvider: i,\n      challengeId: l\n    } = this.context;\n    i.sendClientInfo({\n      Challenge: {\n        FaceMovementAndLightChallenge: {\n          ChallengeId: l,\n          ColorDisplayed: {\n            CurrentColor: {\n              RGB: o(r)\n            },\n            PreviousColor: {\n              RGB: o(t)\n            },\n            SequenceNumber: s,\n            CurrentColorStartTimestamp: e\n          }\n        }\n      }\n    });\n  }\n\n}\n\nexport { s as FreshnessColorDisplay };","map":{"version":3,"names":["__awaiter","e","fillOverlayCanvasFractional","r","getRGBArrayFromColorString","o","t","SCROLLING","FLAT","s","constructor","context","freshnessColorsSequence","isFirstTick","displayColorTick","Promise","setTimeout","displayNextColorTick","Math","min","init","stageIndex","currColorIndex","currColorSequence","prevColorSequence","stage","timeLastFlatOrScrollChange","Date","now","timeLastFaceMatchChecked","freshnessColorEl","freshnessColorAssociatedParams","ovalDetails","i","scaleFactor","l","ovalAssociatedParams","videoEl","n","videoAssociatedParams","c","sendColorStartTime","tickStartTime","currColor","color","prevColor","a","style","display","flatDisplayDuration","downscrollDuration","incrementStageIndex","length","overlayCanvas","nextColor","heightFraction","livenessStreamProvider","challengeId","sendClientInfo","Challenge","FaceMovementAndLightChallenge","ChallengeId","ColorDisplayed","CurrentColor","RGB","PreviousColor","SequenceNumber","CurrentColorStartTimestamp","FreshnessColorDisplay"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/@aws-amplify/ui-react-liveness/dist/esm/components/FaceLivenessDetector/service/utils/freshnessColorDisplay.mjs"],"sourcesContent":["import{__awaiter as e}from\"tslib\";import{fillOverlayCanvasFractional as r,getRGBArrayFromColorString as o}from\"./liveness.mjs\";var t;!function(e){e.SCROLLING=\"SCROLLING\",e.FLAT=\"FLAT\"}(t||(t={}));class s{constructor(e,r){this.context=e,this.freshnessColorsSequence=r,this.isFirstTick=!0}displayColorTick(){return e(this,void 0,void 0,(function*(){return new Promise(((e,r)=>{setTimeout((()=>{this.displayNextColorTick(e,r)}),Math.min(10))}))}))}init(){this.stageIndex=0,this.currColorIndex=0,this.currColorSequence=this.freshnessColorsSequence[0],this.prevColorSequence=this.freshnessColorsSequence[0],this.stage=t.FLAT,this.timeLastFlatOrScrollChange=Date.now(),this.timeLastFaceMatchChecked=Date.now()}displayNextColorTick(e,o){const{freshnessColorEl:s}=this.context.freshnessColorAssociatedParams,{ovalDetails:i,scaleFactor:l}=this.context.ovalAssociatedParams,{videoEl:n}=this.context.videoAssociatedParams,c=Date.now();this.isFirstTick&&(this.init(),this.isFirstTick=!1,this.sendColorStartTime({tickStartTime:c,currColor:this.currColorSequence.color,prevColor:this.currColorSequence.color,currColorIndex:this.stageIndex}));let a=c-this.timeLastFlatOrScrollChange;if(s.style.display=\"block\",(this.stage===t.FLAT&&a>=this.currColorSequence.flatDisplayDuration||this.stage===t.SCROLLING&&a>=this.currColorSequence.downscrollDuration)&&(this.incrementStageIndex(c),a=0),this.currColorIndex<this.freshnessColorsSequence.length){const o=a/(this.stage===t.SCROLLING?this.currColorSequence.downscrollDuration:this.currColorSequence.flatDisplayDuration);r({overlayCanvas:s,prevColor:this.prevColorSequence.color,nextColor:this.currColorSequence.color,videoEl:n,ovalDetails:i,heightFraction:o,scaleFactor:l}),e(!1)}else s.style.display=\"none\",e(!0)}incrementStageIndex(e){if(this.stageIndex+=1,this.prevColorSequence=this.freshnessColorsSequence[this.currColorIndex],this.stage===t.FLAT)this.currColorIndex+=1,this.stage=t.SCROLLING;else if(this.stage===t.SCROLLING){this.freshnessColorsSequence[this.currColorIndex].flatDisplayDuration>0?this.stage=t.FLAT:(this.stage=t.SCROLLING,this.currColorIndex+=1)}this.currColorSequence=this.freshnessColorsSequence[this.currColorIndex],this.timeLastFlatOrScrollChange=Date.now(),this.currColorSequence&&this.sendColorStartTime({tickStartTime:e,currColor:this.currColorSequence.color,prevColor:this.prevColorSequence.color,currColorIndex:this.stageIndex})}sendColorStartTime({tickStartTime:e,currColor:r,prevColor:t,currColorIndex:s}){const{livenessStreamProvider:i,challengeId:l}=this.context;i.sendClientInfo({Challenge:{FaceMovementAndLightChallenge:{ChallengeId:l,ColorDisplayed:{CurrentColor:{RGB:o(r)},PreviousColor:{RGB:o(t)},SequenceNumber:s,CurrentColorStartTimestamp:e}}}})}}export{s as FreshnessColorDisplay};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}