{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __assign, __awaiter, __generator, __read } from \"tslib\";\nimport { parse } from 'url'; // Used for OAuth parsing of Cognito Hosted UI\n\nimport { launchUri } from './urlOpener';\nimport * as oAuthStorage from './oauthStorage';\nimport { Buffer } from 'buffer';\nimport { isCognitoHostedOpts, CognitoHostedUIIdentityProvider } from '../types/Auth';\nimport { AuthAction, Category, ConsoleLogger as Logger, getAmplifyUserAgent, Hub, urlSafeEncode, USER_AGENT_HEADER } from '@aws-amplify/core';\nimport { Sha256 } from '@aws-crypto/sha256-js';\nvar AMPLIFY_SYMBOL = typeof Symbol !== 'undefined' && typeof Symbol.for === 'function' ? Symbol.for('amplify_default') : '@@amplify_default';\n\nvar dispatchAuthEvent = function (event, data, message) {\n  Hub.dispatch('auth', {\n    event: event,\n    data: data,\n    message: message\n  }, 'Auth', AMPLIFY_SYMBOL);\n};\n\nvar logger = new Logger('OAuth');\n\nvar OAuth =\n/** @class */\nfunction () {\n  function OAuth(_a) {\n    var config = _a.config,\n        cognitoClientId = _a.cognitoClientId,\n        _b = _a.scopes,\n        scopes = _b === void 0 ? [] : _b;\n    this._urlOpener = config.urlOpener || launchUri;\n    this._config = config;\n    this._cognitoClientId = cognitoClientId;\n    if (!this.isValidScopes(scopes)) throw Error('scopes must be a String Array');\n    this._scopes = scopes;\n  }\n\n  OAuth.prototype.isValidScopes = function (scopes) {\n    return Array.isArray(scopes) && scopes.every(function (scope) {\n      return typeof scope === 'string';\n    });\n  };\n\n  OAuth.prototype.oauthSignIn = function (responseType, domain, redirectSignIn, clientId, provider, customState) {\n    if (responseType === void 0) {\n      responseType = 'code';\n    }\n\n    if (provider === void 0) {\n      provider = CognitoHostedUIIdentityProvider.Cognito;\n    }\n\n    var generatedState = this._generateState(32);\n    /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n    single-encodes/decodes url on first sign in and double-encodes/decodes url\n    when user already signed in. Using encodeURIComponent, Base32, Base64 add\n    characters % or = which on further encoding becomes unsafe. '=' create issue\n    for parsing query params.\n    Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n\n\n    var state = customState ? generatedState + \"-\" + urlSafeEncode(customState) : generatedState;\n    oAuthStorage.setState(state);\n\n    var pkce_key = this._generateRandom(128);\n\n    oAuthStorage.setPKCE(pkce_key);\n\n    var code_challenge = this._generateChallenge(pkce_key);\n\n    var code_challenge_method = 'S256';\n\n    var scopesString = this._scopes.join(' ');\n\n    var queryString = Object.entries(__assign(__assign({\n      redirect_uri: redirectSignIn,\n      response_type: responseType,\n      client_id: clientId,\n      identity_provider: provider,\n      scope: scopesString,\n      state: state\n    }, responseType === 'code' ? {\n      code_challenge: code_challenge\n    } : {}), responseType === 'code' ? {\n      code_challenge_method: code_challenge_method\n    } : {})).map(function (_a) {\n      var _b = __read(_a, 2),\n          k = _b[0],\n          v = _b[1];\n\n      return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n    }).join('&');\n    var URL = \"https://\" + domain + \"/oauth2/authorize?\" + queryString;\n    logger.debug(\"Redirecting to \" + URL);\n\n    this._urlOpener(URL, redirectSignIn);\n  };\n\n  OAuth.prototype._handleCodeFlow = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var code, currentUrlPathname, redirectSignInPathname, oAuthTokenEndpoint, client_id, redirect_uri, code_verifier, oAuthTokenBody, body, customUserAgentDetails, _a, access_token, refresh_token, id_token, error;\n\n      var _b;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            code = (parse(currentUrl).query || '').split('&').map(function (pairings) {\n              return pairings.split('=');\n            }).reduce(function (accum, _a) {\n              var _b;\n\n              var _c = __read(_a, 2),\n                  k = _c[0],\n                  v = _c[1];\n\n              return __assign(__assign({}, accum), (_b = {}, _b[k] = v, _b));\n            }, {\n              code: undefined\n            }).code;\n            currentUrlPathname = parse(currentUrl).pathname || '/';\n            redirectSignInPathname = parse(this._config.redirectSignIn).pathname || '/';\n\n            if (!code || currentUrlPathname !== redirectSignInPathname) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            oAuthTokenEndpoint = 'https://' + this._config.domain + '/oauth2/token';\n            dispatchAuthEvent('codeFlow', {}, \"Retrieving tokens from \" + oAuthTokenEndpoint);\n            client_id = isCognitoHostedOpts(this._config) ? this._cognitoClientId : this._config.clientID;\n            redirect_uri = isCognitoHostedOpts(this._config) ? this._config.redirectSignIn : this._config.redirectUri;\n            code_verifier = oAuthStorage.getPKCE();\n            oAuthTokenBody = __assign({\n              grant_type: 'authorization_code',\n              code: code,\n              client_id: client_id,\n              redirect_uri: redirect_uri\n            }, code_verifier ? {\n              code_verifier: code_verifier\n            } : {});\n            logger.debug(\"Calling token endpoint: \" + oAuthTokenEndpoint + \" with\", oAuthTokenBody);\n            body = Object.entries(oAuthTokenBody).map(function (_a) {\n              var _b = __read(_a, 2),\n                  k = _b[0],\n                  v = _b[1];\n\n              return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n            }).join('&');\n            customUserAgentDetails = {\n              category: Category.Auth,\n              action: AuthAction.FederatedSignIn\n            };\n            return [4\n            /*yield*/\n            , fetch(oAuthTokenEndpoint, {\n              method: 'POST',\n              headers: (_b = {\n                'Content-Type': 'application/x-www-form-urlencoded'\n              }, _b[USER_AGENT_HEADER] = getAmplifyUserAgent(customUserAgentDetails), _b),\n              body: body\n            })];\n\n          case 1:\n            return [4\n            /*yield*/\n            , _c.sent().json()];\n\n          case 2:\n            _a = _c.sent(), access_token = _a.access_token, refresh_token = _a.refresh_token, id_token = _a.id_token, error = _a.error;\n\n            if (error) {\n              throw new Error(error);\n            }\n\n            return [2\n            /*return*/\n            , {\n              accessToken: access_token,\n              refreshToken: refresh_token,\n              idToken: id_token\n            }];\n        }\n      });\n    });\n  };\n\n  OAuth.prototype._handleImplicitFlow = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, id_token, access_token;\n\n      return __generator(this, function (_b) {\n        _a = (parse(currentUrl).hash || '#').substr(1) // Remove # from returned code\n        .split('&').map(function (pairings) {\n          return pairings.split('=');\n        }).reduce(function (accum, _a) {\n          var _b;\n\n          var _c = __read(_a, 2),\n              k = _c[0],\n              v = _c[1];\n\n          return __assign(__assign({}, accum), (_b = {}, _b[k] = v, _b));\n        }, {\n          id_token: undefined,\n          access_token: undefined\n        }), id_token = _a.id_token, access_token = _a.access_token;\n        dispatchAuthEvent('implicitFlow', {}, \"Got tokens from \" + currentUrl);\n        logger.debug(\"Retrieving implicit tokens from \" + currentUrl + \" with\");\n        return [2\n        /*return*/\n        , {\n          accessToken: access_token,\n          idToken: id_token,\n          refreshToken: null\n        }];\n      });\n    });\n  };\n\n  OAuth.prototype.handleAuthResponse = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var urlParams, error, error_description, state, _a, _b, e_1;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _c.trys.push([0, 5,, 6]);\n\n            urlParams = currentUrl ? __assign(__assign({}, (parse(currentUrl).hash || '#').substr(1).split('&').map(function (entry) {\n              return entry.split('=');\n            }).reduce(function (acc, _a) {\n              var _b = __read(_a, 2),\n                  k = _b[0],\n                  v = _b[1];\n\n              return acc[k] = v, acc;\n            }, {})), (parse(currentUrl).query || '').split('&').map(function (entry) {\n              return entry.split('=');\n            }).reduce(function (acc, _a) {\n              var _b = __read(_a, 2),\n                  k = _b[0],\n                  v = _b[1];\n\n              return acc[k] = v, acc;\n            }, {})) : {};\n            error = urlParams.error, error_description = urlParams.error_description;\n\n            if (error) {\n              throw new Error(error_description);\n            }\n\n            state = this._validateState(urlParams);\n            logger.debug(\"Starting \" + this._config.responseType + \" flow with \" + currentUrl);\n            if (!(this._config.responseType === 'code')) return [3\n            /*break*/\n            , 2];\n            _a = [{}];\n            return [4\n            /*yield*/\n            , this._handleCodeFlow(currentUrl)];\n\n          case 1:\n            return [2\n            /*return*/\n            , __assign.apply(void 0, [__assign.apply(void 0, _a.concat([_c.sent()])), {\n              state: state\n            }])];\n\n          case 2:\n            _b = [{}];\n            return [4\n            /*yield*/\n            , this._handleImplicitFlow(currentUrl)];\n\n          case 3:\n            return [2\n            /*return*/\n            , __assign.apply(void 0, [__assign.apply(void 0, _b.concat([_c.sent()])), {\n              state: state\n            }])];\n\n          case 4:\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            e_1 = _c.sent();\n            logger.debug(\"Error handling auth response.\", e_1);\n            throw e_1;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  OAuth.prototype._validateState = function (urlParams) {\n    if (!urlParams) {\n      return;\n    }\n\n    var savedState = oAuthStorage.getState();\n    var returnedState = urlParams.state; // This is because savedState only exists if the flow was initiated by Amplify\n\n    if (savedState && savedState !== returnedState) {\n      throw new Error('Invalid state in OAuth flow');\n    }\n\n    return returnedState;\n  };\n\n  OAuth.prototype.signOut = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var oAuthLogoutEndpoint, client_id, signout_uri;\n      return __generator(this, function (_a) {\n        oAuthLogoutEndpoint = 'https://' + this._config.domain + '/logout?';\n        client_id = isCognitoHostedOpts(this._config) ? this._cognitoClientId : this._config.oauth.clientID;\n        signout_uri = isCognitoHostedOpts(this._config) ? this._config.redirectSignOut : this._config.returnTo;\n        oAuthLogoutEndpoint += Object.entries({\n          client_id: client_id,\n          logout_uri: encodeURIComponent(signout_uri)\n        }).map(function (_a) {\n          var _b = __read(_a, 2),\n              k = _b[0],\n              v = _b[1];\n\n          return k + \"=\" + v;\n        }).join('&');\n        dispatchAuthEvent('oAuthSignOut', {\n          oAuth: 'signOut'\n        }, \"Signing out from \" + oAuthLogoutEndpoint);\n        logger.debug(\"Signing out from \" + oAuthLogoutEndpoint);\n        return [2\n        /*return*/\n        , this._urlOpener(oAuthLogoutEndpoint, signout_uri)];\n      });\n    });\n  };\n\n  OAuth.prototype._generateState = function (length) {\n    var result = '';\n    var i = length;\n    var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\n    for (; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n\n    return result;\n  };\n\n  OAuth.prototype._generateChallenge = function (code) {\n    var awsCryptoHash = new Sha256();\n    awsCryptoHash.update(code);\n    var resultFromAWSCrypto = awsCryptoHash.digestSync();\n    var b64 = Buffer.from(resultFromAWSCrypto).toString('base64');\n\n    var base64URLFromAWSCrypto = this._base64URL(b64);\n\n    return base64URLFromAWSCrypto;\n  };\n\n  OAuth.prototype._base64URL = function (string) {\n    return string.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n  };\n\n  OAuth.prototype._generateRandom = function (size) {\n    var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';\n    var buffer = new Uint8Array(size);\n\n    if (typeof window !== 'undefined' && !!window.crypto) {\n      window.crypto.getRandomValues(buffer);\n    } else {\n      for (var i = 0; i < size; i += 1) {\n        buffer[i] = Math.random() * CHARSET.length | 0;\n      }\n    }\n\n    return this._bufferToString(buffer);\n  };\n\n  OAuth.prototype._bufferToString = function (buffer) {\n    var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    var state = [];\n\n    for (var i = 0; i < buffer.byteLength; i += 1) {\n      var index = buffer[i] % CHARSET.length;\n      state.push(CHARSET[index]);\n    }\n\n    return state.join('');\n  };\n\n  return OAuth;\n}();\n\nexport default OAuth;","map":{"version":3,"names":["__assign","__awaiter","__generator","__read","parse","launchUri","oAuthStorage","Buffer","isCognitoHostedOpts","CognitoHostedUIIdentityProvider","AuthAction","Category","ConsoleLogger","Logger","getAmplifyUserAgent","Hub","urlSafeEncode","USER_AGENT_HEADER","Sha256","AMPLIFY_SYMBOL","Symbol","for","dispatchAuthEvent","event","data","message","dispatch","logger","OAuth","_a","config","cognitoClientId","_b","scopes","_urlOpener","urlOpener","_config","_cognitoClientId","isValidScopes","Error","_scopes","prototype","Array","isArray","every","scope","oauthSignIn","responseType","domain","redirectSignIn","clientId","provider","customState","Cognito","generatedState","_generateState","state","setState","pkce_key","_generateRandom","setPKCE","code_challenge","_generateChallenge","code_challenge_method","scopesString","join","queryString","Object","entries","redirect_uri","response_type","client_id","identity_provider","map","k","v","encodeURIComponent","URL","debug","_handleCodeFlow","currentUrl","code","currentUrlPathname","redirectSignInPathname","oAuthTokenEndpoint","code_verifier","oAuthTokenBody","body","customUserAgentDetails","access_token","refresh_token","id_token","error","_c","label","query","split","pairings","reduce","accum","undefined","pathname","clientID","redirectUri","getPKCE","grant_type","category","Auth","action","FederatedSignIn","fetch","method","headers","sent","json","accessToken","refreshToken","idToken","_handleImplicitFlow","hash","substr","handleAuthResponse","urlParams","error_description","e_1","trys","push","entry","acc","_validateState","apply","concat","savedState","getState","returnedState","signOut","oAuthLogoutEndpoint","signout_uri","oauth","redirectSignOut","returnTo","logout_uri","oAuth","length","result","i","chars","Math","round","random","awsCryptoHash","update","resultFromAWSCrypto","digestSync","b64","from","toString","base64URLFromAWSCrypto","_base64URL","string","replace","size","CHARSET","buffer","Uint8Array","window","crypto","getRandomValues","_bufferToString","byteLength","index"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/@aws-amplify/auth/lib-esm/OAuth/OAuth.js"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __assign, __awaiter, __generator, __read } from \"tslib\";\nimport { parse } from 'url'; // Used for OAuth parsing of Cognito Hosted UI\nimport { launchUri } from './urlOpener';\nimport * as oAuthStorage from './oauthStorage';\nimport { Buffer } from 'buffer';\nimport { isCognitoHostedOpts, CognitoHostedUIIdentityProvider, } from '../types/Auth';\nimport { AuthAction, Category, ConsoleLogger as Logger, getAmplifyUserAgent, Hub, urlSafeEncode, USER_AGENT_HEADER, } from '@aws-amplify/core';\nimport { Sha256 } from '@aws-crypto/sha256-js';\nvar AMPLIFY_SYMBOL = (typeof Symbol !== 'undefined' && typeof Symbol.for === 'function'\n    ? Symbol.for('amplify_default')\n    : '@@amplify_default');\nvar dispatchAuthEvent = function (event, data, message) {\n    Hub.dispatch('auth', { event: event, data: data, message: message }, 'Auth', AMPLIFY_SYMBOL);\n};\nvar logger = new Logger('OAuth');\nvar OAuth = /** @class */ (function () {\n    function OAuth(_a) {\n        var config = _a.config, cognitoClientId = _a.cognitoClientId, _b = _a.scopes, scopes = _b === void 0 ? [] : _b;\n        this._urlOpener = config.urlOpener || launchUri;\n        this._config = config;\n        this._cognitoClientId = cognitoClientId;\n        if (!this.isValidScopes(scopes))\n            throw Error('scopes must be a String Array');\n        this._scopes = scopes;\n    }\n    OAuth.prototype.isValidScopes = function (scopes) {\n        return (Array.isArray(scopes) && scopes.every(function (scope) { return typeof scope === 'string'; }));\n    };\n    OAuth.prototype.oauthSignIn = function (responseType, domain, redirectSignIn, clientId, provider, customState) {\n        if (responseType === void 0) { responseType = 'code'; }\n        if (provider === void 0) { provider = CognitoHostedUIIdentityProvider.Cognito; }\n        var generatedState = this._generateState(32);\n        /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n        single-encodes/decodes url on first sign in and double-encodes/decodes url\n        when user already signed in. Using encodeURIComponent, Base32, Base64 add\n        characters % or = which on further encoding becomes unsafe. '=' create issue\n        for parsing query params.\n        Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n        var state = customState\n            ? generatedState + \"-\" + urlSafeEncode(customState)\n            : generatedState;\n        oAuthStorage.setState(state);\n        var pkce_key = this._generateRandom(128);\n        oAuthStorage.setPKCE(pkce_key);\n        var code_challenge = this._generateChallenge(pkce_key);\n        var code_challenge_method = 'S256';\n        var scopesString = this._scopes.join(' ');\n        var queryString = Object.entries(__assign(__assign({ redirect_uri: redirectSignIn, response_type: responseType, client_id: clientId, identity_provider: provider, scope: scopesString, state: state }, (responseType === 'code' ? { code_challenge: code_challenge } : {})), (responseType === 'code' ? { code_challenge_method: code_challenge_method } : {})))\n            .map(function (_a) {\n            var _b = __read(_a, 2), k = _b[0], v = _b[1];\n            return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n        })\n            .join('&');\n        var URL = \"https://\" + domain + \"/oauth2/authorize?\" + queryString;\n        logger.debug(\"Redirecting to \" + URL);\n        this._urlOpener(URL, redirectSignIn);\n    };\n    OAuth.prototype._handleCodeFlow = function (currentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            var code, currentUrlPathname, redirectSignInPathname, oAuthTokenEndpoint, client_id, redirect_uri, code_verifier, oAuthTokenBody, body, customUserAgentDetails, _a, access_token, refresh_token, id_token, error;\n            var _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        code = (parse(currentUrl).query || '')\n                            .split('&')\n                            .map(function (pairings) { return pairings.split('='); })\n                            .reduce(function (accum, _a) {\n                            var _b;\n                            var _c = __read(_a, 2), k = _c[0], v = _c[1];\n                            return (__assign(__assign({}, accum), (_b = {}, _b[k] = v, _b)));\n                        }, { code: undefined }).code;\n                        currentUrlPathname = parse(currentUrl).pathname || '/';\n                        redirectSignInPathname = parse(this._config.redirectSignIn).pathname || '/';\n                        if (!code || currentUrlPathname !== redirectSignInPathname) {\n                            return [2 /*return*/];\n                        }\n                        oAuthTokenEndpoint = 'https://' + this._config.domain + '/oauth2/token';\n                        dispatchAuthEvent('codeFlow', {}, \"Retrieving tokens from \" + oAuthTokenEndpoint);\n                        client_id = isCognitoHostedOpts(this._config)\n                            ? this._cognitoClientId\n                            : this._config.clientID;\n                        redirect_uri = isCognitoHostedOpts(this._config)\n                            ? this._config.redirectSignIn\n                            : this._config.redirectUri;\n                        code_verifier = oAuthStorage.getPKCE();\n                        oAuthTokenBody = __assign({ grant_type: 'authorization_code', code: code,\n                            client_id: client_id,\n                            redirect_uri: redirect_uri }, (code_verifier ? { code_verifier: code_verifier } : {}));\n                        logger.debug(\"Calling token endpoint: \" + oAuthTokenEndpoint + \" with\", oAuthTokenBody);\n                        body = Object.entries(oAuthTokenBody)\n                            .map(function (_a) {\n                            var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                            return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n                        })\n                            .join('&');\n                        customUserAgentDetails = {\n                            category: Category.Auth,\n                            action: AuthAction.FederatedSignIn,\n                        };\n                        return [4 /*yield*/, fetch(oAuthTokenEndpoint, {\n                                method: 'POST',\n                                headers: (_b = {\n                                        'Content-Type': 'application/x-www-form-urlencoded'\n                                    },\n                                    _b[USER_AGENT_HEADER] = getAmplifyUserAgent(customUserAgentDetails),\n                                    _b),\n                                body: body,\n                            })];\n                    case 1: return [4 /*yield*/, (_c.sent()).json()];\n                    case 2:\n                        _a = _c.sent(), access_token = _a.access_token, refresh_token = _a.refresh_token, id_token = _a.id_token, error = _a.error;\n                        if (error) {\n                            throw new Error(error);\n                        }\n                        return [2 /*return*/, {\n                                accessToken: access_token,\n                                refreshToken: refresh_token,\n                                idToken: id_token,\n                            }];\n                }\n            });\n        });\n    };\n    OAuth.prototype._handleImplicitFlow = function (currentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, id_token, access_token;\n            return __generator(this, function (_b) {\n                _a = (parse(currentUrl).hash || '#')\n                    .substr(1) // Remove # from returned code\n                    .split('&')\n                    .map(function (pairings) { return pairings.split('='); })\n                    .reduce(function (accum, _a) {\n                    var _b;\n                    var _c = __read(_a, 2), k = _c[0], v = _c[1];\n                    return (__assign(__assign({}, accum), (_b = {}, _b[k] = v, _b)));\n                }, {\n                    id_token: undefined,\n                    access_token: undefined,\n                }), id_token = _a.id_token, access_token = _a.access_token;\n                dispatchAuthEvent('implicitFlow', {}, \"Got tokens from \" + currentUrl);\n                logger.debug(\"Retrieving implicit tokens from \" + currentUrl + \" with\");\n                return [2 /*return*/, {\n                        accessToken: access_token,\n                        idToken: id_token,\n                        refreshToken: null,\n                    }];\n            });\n        });\n    };\n    OAuth.prototype.handleAuthResponse = function (currentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            var urlParams, error, error_description, state, _a, _b, e_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 5, , 6]);\n                        urlParams = currentUrl\n                            ? __assign(__assign({}, (parse(currentUrl).hash || '#')\n                                .substr(1)\n                                .split('&')\n                                .map(function (entry) { return entry.split('='); })\n                                .reduce(function (acc, _a) {\n                                var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                                return ((acc[k] = v), acc);\n                            }, {})), (parse(currentUrl).query || '')\n                                .split('&')\n                                .map(function (entry) { return entry.split('='); })\n                                .reduce(function (acc, _a) {\n                                var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                                return ((acc[k] = v), acc);\n                            }, {}))\n                            : {};\n                        error = urlParams.error, error_description = urlParams.error_description;\n                        if (error) {\n                            throw new Error(error_description);\n                        }\n                        state = this._validateState(urlParams);\n                        logger.debug(\"Starting \" + this._config.responseType + \" flow with \" + currentUrl);\n                        if (!(this._config.responseType === 'code')) return [3 /*break*/, 2];\n                        _a = [{}];\n                        return [4 /*yield*/, this._handleCodeFlow(currentUrl)];\n                    case 1: return [2 /*return*/, __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_c.sent())])), { state: state }])];\n                    case 2:\n                        _b = [{}];\n                        return [4 /*yield*/, this._handleImplicitFlow(currentUrl)];\n                    case 3: return [2 /*return*/, __assign.apply(void 0, [__assign.apply(void 0, _b.concat([(_c.sent())])), { state: state }])];\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        e_1 = _c.sent();\n                        logger.debug(\"Error handling auth response.\", e_1);\n                        throw e_1;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    OAuth.prototype._validateState = function (urlParams) {\n        if (!urlParams) {\n            return;\n        }\n        var savedState = oAuthStorage.getState();\n        var returnedState = urlParams.state;\n        // This is because savedState only exists if the flow was initiated by Amplify\n        if (savedState && savedState !== returnedState) {\n            throw new Error('Invalid state in OAuth flow');\n        }\n        return returnedState;\n    };\n    OAuth.prototype.signOut = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var oAuthLogoutEndpoint, client_id, signout_uri;\n            return __generator(this, function (_a) {\n                oAuthLogoutEndpoint = 'https://' + this._config.domain + '/logout?';\n                client_id = isCognitoHostedOpts(this._config)\n                    ? this._cognitoClientId\n                    : this._config.oauth.clientID;\n                signout_uri = isCognitoHostedOpts(this._config)\n                    ? this._config.redirectSignOut\n                    : this._config.returnTo;\n                oAuthLogoutEndpoint += Object.entries({\n                    client_id: client_id,\n                    logout_uri: encodeURIComponent(signout_uri),\n                })\n                    .map(function (_a) {\n                    var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                    return k + \"=\" + v;\n                })\n                    .join('&');\n                dispatchAuthEvent('oAuthSignOut', { oAuth: 'signOut' }, \"Signing out from \" + oAuthLogoutEndpoint);\n                logger.debug(\"Signing out from \" + oAuthLogoutEndpoint);\n                return [2 /*return*/, this._urlOpener(oAuthLogoutEndpoint, signout_uri)];\n            });\n        });\n    };\n    OAuth.prototype._generateState = function (length) {\n        var result = '';\n        var i = length;\n        var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n        for (; i > 0; --i)\n            result += chars[Math.round(Math.random() * (chars.length - 1))];\n        return result;\n    };\n    OAuth.prototype._generateChallenge = function (code) {\n        var awsCryptoHash = new Sha256();\n        awsCryptoHash.update(code);\n        var resultFromAWSCrypto = awsCryptoHash.digestSync();\n        var b64 = Buffer.from(resultFromAWSCrypto).toString('base64');\n        var base64URLFromAWSCrypto = this._base64URL(b64);\n        return base64URLFromAWSCrypto;\n    };\n    OAuth.prototype._base64URL = function (string) {\n        return string.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n    };\n    OAuth.prototype._generateRandom = function (size) {\n        var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';\n        var buffer = new Uint8Array(size);\n        if (typeof window !== 'undefined' && !!window.crypto) {\n            window.crypto.getRandomValues(buffer);\n        }\n        else {\n            for (var i = 0; i < size; i += 1) {\n                buffer[i] = (Math.random() * CHARSET.length) | 0;\n            }\n        }\n        return this._bufferToString(buffer);\n    };\n    OAuth.prototype._bufferToString = function (buffer) {\n        var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n        var state = [];\n        for (var i = 0; i < buffer.byteLength; i += 1) {\n            var index = buffer[i] % CHARSET.length;\n            state.push(CHARSET[index]);\n        }\n        return state.join('');\n    };\n    return OAuth;\n}());\nexport default OAuth;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}