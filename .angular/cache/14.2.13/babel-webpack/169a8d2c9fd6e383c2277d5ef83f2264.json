{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __awaiter, __generator } from \"tslib\"; // the session tracker for web\n\nimport { ConsoleLogger as Logger, browserOrNode } from '@aws-amplify/core';\nvar logger = new Logger('SessionTracker');\nvar defaultOpts = {\n  enable: false,\n  provider: 'AWSPinpoint'\n};\nvar initialEventSent = false;\n\nvar SessionTracker =\n/** @class */\nfunction () {\n  function SessionTracker(tracker, opts) {\n    this._config = Object.assign({}, defaultOpts, opts);\n    this._tracker = tracker;\n    this._hasEnabled = false;\n    this._trackFunc = this._trackFunc.bind(this);\n    this._trackBeforeUnload = this._trackBeforeUnload.bind(this);\n    this.configure(this._config);\n  }\n\n  SessionTracker.prototype._envCheck = function () {\n    if (!browserOrNode().isBrowser) {\n      return false;\n    }\n\n    if (!document || !document.addEventListener) {\n      logger.debug('not in the supported web environment');\n      return false;\n    }\n\n    if (typeof document.hidden !== 'undefined') {\n      this._hidden = 'hidden';\n      this._visibilityChange = 'visibilitychange';\n    } else if (typeof document['msHidden'] !== 'undefined') {\n      this._hidden = 'msHidden';\n      this._visibilityChange = 'msvisibilitychange';\n    } else if (typeof document['webkitHidden'] !== 'undefined') {\n      this._hidden = 'webkitHidden';\n      this._visibilityChange = 'webkitvisibilitychange';\n    } else {\n      logger.debug('not in the supported web environment');\n      return false;\n    }\n\n    return true;\n  };\n\n  SessionTracker.prototype._trackFunc = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var customAttrs, _a, attributes;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!(typeof this._config.attributes === 'function')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this._config.attributes()];\n\n          case 1:\n            _a = _b.sent();\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            _a = this._config.attributes;\n            _b.label = 3;\n\n          case 3:\n            customAttrs = _a;\n            attributes = Object.assign({}, customAttrs);\n\n            if (document.visibilityState === this._hidden) {\n              this._tracker({\n                name: '_session.stop',\n                attributes: attributes\n              }, this._config.provider).catch(function (e) {\n                logger.debug('record session stop event failed.', e);\n              });\n            } else {\n              this._tracker({\n                name: '_session.start',\n                attributes: attributes\n              }, this._config.provider).catch(function (e) {\n                logger.debug('record session start event failed.', e);\n              });\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SessionTracker.prototype._trackBeforeUnload = function (event) {\n    // before unload callback cannot be async => https://github.com/aws-amplify/amplify-js/issues/2088\n    var _this = this;\n\n    var customAttrs = typeof this._config.attributes === 'function' ? Promise.resolve(this._config.attributes()) : Promise.resolve(this._config.attributes);\n    customAttrs.then(function (custom) {\n      var attributes = Object.assign({}, custom);\n\n      _this._tracker({\n        name: '_session.stop',\n        attributes: attributes,\n        immediate: true\n      }, _this._config.provider).catch(function (e) {\n        logger.debug('record session stop event failed.', e);\n      });\n    });\n  }; // to keep configure a synchronized function\n\n\n  SessionTracker.prototype._sendInitialEvent = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var customAttrs, _a, attributes;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (initialEventSent) {\n              logger.debug('the start session has been sent when the page is loaded');\n              return [2\n              /*return*/\n              ];\n            } else {\n              initialEventSent = true;\n            }\n\n            if (!(typeof this._config.attributes === 'function')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this._config.attributes()];\n\n          case 1:\n            _a = _b.sent();\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            _a = this._config.attributes;\n            _b.label = 3;\n\n          case 3:\n            customAttrs = _a;\n            attributes = Object.assign({}, customAttrs);\n\n            this._tracker({\n              name: '_session.start',\n              attributes: attributes\n            }, this._config.provider).catch(function (e) {\n              logger.debug('record session start event failed.', e);\n            });\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SessionTracker.prototype.configure = function (opts) {\n    if (!this._envCheck()) {\n      return this._config;\n    }\n\n    Object.assign(this._config, opts);\n\n    if (this._config.enable && !this._hasEnabled) {\n      // send a start session as soon as it's enabled\n      this._sendInitialEvent(); // listen on events\n\n\n      document.addEventListener(this._visibilityChange, this._trackFunc, false);\n      window.addEventListener('beforeunload', this._trackBeforeUnload, false);\n      this._hasEnabled = true;\n    } else if (!this._config.enable && this._hasEnabled) {\n      document.removeEventListener(this._visibilityChange, this._trackFunc, false);\n      window.removeEventListener('beforeunload', this._trackBeforeUnload, false);\n      this._hasEnabled = false;\n    }\n\n    return this._config;\n  };\n\n  return SessionTracker;\n}();\n\nexport { SessionTracker };","map":{"version":3,"names":["__awaiter","__generator","ConsoleLogger","Logger","browserOrNode","logger","defaultOpts","enable","provider","initialEventSent","SessionTracker","tracker","opts","_config","Object","assign","_tracker","_hasEnabled","_trackFunc","bind","_trackBeforeUnload","configure","prototype","_envCheck","isBrowser","document","addEventListener","debug","hidden","_hidden","_visibilityChange","customAttrs","_a","attributes","_b","label","sent","visibilityState","name","catch","e","event","_this","Promise","resolve","then","custom","immediate","_sendInitialEvent","window","removeEventListener"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/@aws-amplify/analytics/lib-esm/trackers/SessionTracker.js"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __awaiter, __generator } from \"tslib\";\n// the session tracker for web\nimport { ConsoleLogger as Logger, browserOrNode, } from '@aws-amplify/core';\nvar logger = new Logger('SessionTracker');\nvar defaultOpts = {\n    enable: false,\n    provider: 'AWSPinpoint',\n};\nvar initialEventSent = false;\nvar SessionTracker = /** @class */ (function () {\n    function SessionTracker(tracker, opts) {\n        this._config = Object.assign({}, defaultOpts, opts);\n        this._tracker = tracker;\n        this._hasEnabled = false;\n        this._trackFunc = this._trackFunc.bind(this);\n        this._trackBeforeUnload = this._trackBeforeUnload.bind(this);\n        this.configure(this._config);\n    }\n    SessionTracker.prototype._envCheck = function () {\n        if (!browserOrNode().isBrowser) {\n            return false;\n        }\n        if (!document || !document.addEventListener) {\n            logger.debug('not in the supported web environment');\n            return false;\n        }\n        if (typeof document.hidden !== 'undefined') {\n            this._hidden = 'hidden';\n            this._visibilityChange = 'visibilitychange';\n        }\n        else if (typeof document['msHidden'] !== 'undefined') {\n            this._hidden = 'msHidden';\n            this._visibilityChange = 'msvisibilitychange';\n        }\n        else if (typeof document['webkitHidden'] !== 'undefined') {\n            this._hidden = 'webkitHidden';\n            this._visibilityChange = 'webkitvisibilitychange';\n        }\n        else {\n            logger.debug('not in the supported web environment');\n            return false;\n        }\n        return true;\n    };\n    SessionTracker.prototype._trackFunc = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var customAttrs, _a, attributes;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!(typeof this._config.attributes === 'function')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this._config.attributes()];\n                    case 1:\n                        _a = _b.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _a = this._config.attributes;\n                        _b.label = 3;\n                    case 3:\n                        customAttrs = _a;\n                        attributes = Object.assign({}, customAttrs);\n                        if (document.visibilityState === this._hidden) {\n                            this._tracker({\n                                name: '_session.stop',\n                                attributes: attributes,\n                            }, this._config.provider).catch(function (e) {\n                                logger.debug('record session stop event failed.', e);\n                            });\n                        }\n                        else {\n                            this._tracker({\n                                name: '_session.start',\n                                attributes: attributes,\n                            }, this._config.provider).catch(function (e) {\n                                logger.debug('record session start event failed.', e);\n                            });\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SessionTracker.prototype._trackBeforeUnload = function (event) {\n        // before unload callback cannot be async => https://github.com/aws-amplify/amplify-js/issues/2088\n        var _this = this;\n        var customAttrs = typeof this._config.attributes === 'function'\n            ? Promise.resolve(this._config.attributes())\n            : Promise.resolve(this._config.attributes);\n        customAttrs.then(function (custom) {\n            var attributes = Object.assign({}, custom);\n            _this._tracker({\n                name: '_session.stop',\n                attributes: attributes,\n                immediate: true,\n            }, _this._config.provider).catch(function (e) {\n                logger.debug('record session stop event failed.', e);\n            });\n        });\n    };\n    // to keep configure a synchronized function\n    SessionTracker.prototype._sendInitialEvent = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var customAttrs, _a, attributes;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (initialEventSent) {\n                            logger.debug('the start session has been sent when the page is loaded');\n                            return [2 /*return*/];\n                        }\n                        else {\n                            initialEventSent = true;\n                        }\n                        if (!(typeof this._config.attributes === 'function')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this._config.attributes()];\n                    case 1:\n                        _a = _b.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _a = this._config.attributes;\n                        _b.label = 3;\n                    case 3:\n                        customAttrs = _a;\n                        attributes = Object.assign({}, customAttrs);\n                        this._tracker({\n                            name: '_session.start',\n                            attributes: attributes,\n                        }, this._config.provider).catch(function (e) {\n                            logger.debug('record session start event failed.', e);\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SessionTracker.prototype.configure = function (opts) {\n        if (!this._envCheck()) {\n            return this._config;\n        }\n        Object.assign(this._config, opts);\n        if (this._config.enable && !this._hasEnabled) {\n            // send a start session as soon as it's enabled\n            this._sendInitialEvent();\n            // listen on events\n            document.addEventListener(this._visibilityChange, this._trackFunc, false);\n            window.addEventListener('beforeunload', this._trackBeforeUnload, false);\n            this._hasEnabled = true;\n        }\n        else if (!this._config.enable && this._hasEnabled) {\n            document.removeEventListener(this._visibilityChange, this._trackFunc, false);\n            window.removeEventListener('beforeunload', this._trackBeforeUnload, false);\n            this._hasEnabled = false;\n        }\n        return this._config;\n    };\n    return SessionTracker;\n}());\nexport { SessionTracker };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}