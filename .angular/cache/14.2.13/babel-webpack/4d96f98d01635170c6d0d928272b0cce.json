{"ast":null,"code":"import { __values, __spreadArray, __read, __assign } from './_virtual/_tslib.js';\nimport { SpecialTargets, ActionTypes } from './types.js';\nimport { isStateConfig, State, bindActionToState } from './State.js';\nimport { errorPlatform, update, error as error$1, log, stop, start, cancel, send, raise } from './actionTypes.js';\nimport { initEvent, doneInvoke, toActionObjects, resolveActions, error, getActionFunction } from './actions.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { warn, mapContext, toObserver, isFunction, toSCXMLEvent, flatten, isRaisableAction, isPromiseLike, isObservable, isMachine, isBehavior, reportUnhandledExceptionOnInvocation, symbolObservable, isArray, toEventObject, isString, isActor, toInvokeSource, uniqueId } from './utils.js';\nimport { Scheduler } from './scheduler.js';\nimport { createDeferredActor, isSpawnedActor } from './Actor.js';\nimport { registry } from './registry.js';\nimport { getGlobal, registerService } from './devTools.js';\nimport { provide, consume } from './serviceScope.js';\nimport { spawnBehavior } from './behaviors.js';\nvar DEFAULT_SPAWN_OPTIONS = {\n  sync: false,\n  autoForward: false\n};\nvar InterpreterStatus;\n\n(function (InterpreterStatus) {\n  InterpreterStatus[InterpreterStatus[\"NotStarted\"] = 0] = \"NotStarted\";\n  InterpreterStatus[InterpreterStatus[\"Running\"] = 1] = \"Running\";\n  InterpreterStatus[InterpreterStatus[\"Stopped\"] = 2] = \"Stopped\";\n})(InterpreterStatus || (InterpreterStatus = {}));\n\nvar Interpreter =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new Interpreter instance (i.e., service) for the given machine with the provided options, if any.\r\n   *\r\n   * @param machine The machine to be interpreted\r\n   * @param options Interpreter options\r\n   */\n  function Interpreter(machine, options) {\n    if (options === void 0) {\n      options = Interpreter.defaultOptions;\n    }\n\n    var _this = this;\n\n    this.machine = machine;\n    this.delayedEventsMap = {};\n    this.listeners = new Set();\n    this.contextListeners = new Set();\n    this.stopListeners = new Set();\n    this.doneListeners = new Set();\n    this.eventListeners = new Set();\n    this.sendListeners = new Set();\n    /**\r\n     * Whether the service is started.\r\n     */\n\n    this.initialized = false;\n    this.status = InterpreterStatus.NotStarted;\n    this.children = new Map();\n    this.forwardTo = new Set();\n    this._outgoingQueue = [];\n    /**\r\n     * Alias for Interpreter.prototype.start\r\n     */\n\n    this.init = this.start;\n    /**\r\n     * Sends an event to the running interpreter to trigger a transition.\r\n     *\r\n     * An array of events (batched) can be sent as well, which will send all\r\n     * batched events to the running interpreter. The listeners will be\r\n     * notified only **once** when all events are processed.\r\n     *\r\n     * @param event The event(s) to send\r\n     */\n\n    this.send = function (event, payload) {\n      if (isArray(event)) {\n        _this.batch(event);\n\n        return _this.state;\n      }\n\n      var _event = toSCXMLEvent(toEventObject(event, payload));\n\n      if (_this.status === InterpreterStatus.Stopped) {\n        // do nothing\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\".concat(_event.name, \"\\\" was sent to stopped service \\\"\").concat(_this.machine.id, \"\\\". This service has already reached its final state, and will not transition.\\nEvent: \").concat(JSON.stringify(_event.data)));\n        }\n\n        return _this.state;\n      }\n\n      if (_this.status !== InterpreterStatus.Running && !_this.options.deferEvents) {\n        throw new Error(\"Event \\\"\".concat(_event.name, \"\\\" was sent to uninitialized service \\\"\").concat(_this.machine.id // tslint:disable-next-line:max-line-length\n        , \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\\nEvent: \").concat(JSON.stringify(_event.data)));\n      }\n\n      _this.scheduler.schedule(function () {\n        // Forward copy of event to child actors\n        _this.forward(_event);\n\n        var nextState = _this._nextState(_event);\n\n        _this.update(nextState, _event);\n      });\n\n      return _this._state; // TODO: deprecate (should return void)\n      // tslint:disable-next-line:semicolon\n    };\n\n    this.sendTo = function (event, to, immediate) {\n      var isParent = _this.parent && (to === SpecialTargets.Parent || _this.parent.id === to);\n      var target = isParent ? _this.parent : isString(to) ? to === SpecialTargets.Internal ? _this : _this.children.get(to) || registry.get(to) : isActor(to) ? to : undefined;\n\n      if (!target) {\n        if (!isParent) {\n          throw new Error(\"Unable to send event to child '\".concat(to, \"' from service '\").concat(_this.id, \"'.\"));\n        } // tslint:disable-next-line:no-console\n\n\n        if (!IS_PRODUCTION) {\n          warn(false, \"Service '\".concat(_this.id, \"' has no parent: unable to send event \").concat(event.type));\n        }\n\n        return;\n      }\n\n      if ('machine' in target) {\n        // perhaps those events should be rejected in the parent\n        // but atm it doesn't have easy access to all of the information that is required to do it reliably\n        if (_this.status !== InterpreterStatus.Stopped || _this.parent !== target || // we need to send events to the parent from exit handlers of a machine that reached its final state\n        _this.state.done) {\n          // Send SCXML events to machines\n          var scxmlEvent = __assign(__assign({}, event), {\n            name: event.name === error$1 ? \"\".concat(error(_this.id)) : event.name,\n            origin: _this.sessionId\n          });\n\n          if (!immediate && _this.machine.config.predictableActionArguments) {\n            _this._outgoingQueue.push([target, scxmlEvent]);\n          } else {\n            target.send(scxmlEvent);\n          }\n        }\n      } else {\n        // Send normal events to other targets\n        if (!immediate && _this.machine.config.predictableActionArguments) {\n          _this._outgoingQueue.push([target, event.data]);\n        } else {\n          target.send(event.data);\n        }\n      }\n    };\n\n    this._exec = function (action, context, _event, actionFunctionMap) {\n      if (actionFunctionMap === void 0) {\n        actionFunctionMap = _this.machine.options.actions;\n      }\n\n      var actionOrExec = action.exec || getActionFunction(action.type, actionFunctionMap);\n      var exec = isFunction(actionOrExec) ? actionOrExec : actionOrExec ? actionOrExec.exec : action.exec;\n\n      if (exec) {\n        try {\n          return exec(context, _event.data, !_this.machine.config.predictableActionArguments ? {\n            action: action,\n            state: _this.state,\n            _event: _event\n          } : {\n            action: action,\n            _event: _event\n          });\n        } catch (err) {\n          if (_this.parent) {\n            _this.parent.send({\n              type: 'xstate.error',\n              data: err\n            });\n          }\n\n          throw err;\n        }\n      }\n\n      switch (action.type) {\n        case raise:\n          {\n            // if raise action reached the interpreter then it's a delayed one\n            var sendAction_1 = action;\n\n            _this.defer(sendAction_1);\n\n            break;\n          }\n\n        case send:\n          var sendAction = action;\n\n          if (typeof sendAction.delay === 'number') {\n            _this.defer(sendAction);\n\n            return;\n          } else {\n            if (sendAction.to) {\n              _this.sendTo(sendAction._event, sendAction.to, _event === initEvent);\n            } else {\n              _this.send(sendAction._event);\n            }\n          }\n\n          break;\n\n        case cancel:\n          _this.cancel(action.sendId);\n\n          break;\n\n        case start:\n          {\n            if (_this.status !== InterpreterStatus.Running) {\n              return;\n            }\n\n            var activity = action.activity; // If the activity will be stopped right after it's started\n            // (such as in transient states)\n            // don't bother starting the activity.\n\n            if ( // in v4 with `predictableActionArguments` invokes are called eagerly when the `this.state` still points to the previous state\n            !_this.machine.config.predictableActionArguments && !_this.state.activities[activity.id || activity.type]) {\n              break;\n            } // Invoked services\n\n\n            if (activity.type === ActionTypes.Invoke) {\n              var invokeSource = toInvokeSource(activity.src);\n              var serviceCreator = _this.machine.options.services ? _this.machine.options.services[invokeSource.type] : undefined;\n              var id = activity.id,\n                  data = activity.data;\n\n              if (!IS_PRODUCTION) {\n                warn(!('forward' in activity), // tslint:disable-next-line:max-line-length\n                \"`forward` property is deprecated (found in invocation of '\".concat(activity.src, \"' in in machine '\").concat(_this.machine.id, \"'). \") + \"Please use `autoForward` instead.\");\n              }\n\n              var autoForward = 'autoForward' in activity ? activity.autoForward : !!activity.forward;\n\n              if (!serviceCreator) {\n                // tslint:disable-next-line:no-console\n                if (!IS_PRODUCTION) {\n                  warn(false, \"No service found for invocation '\".concat(activity.src, \"' in machine '\").concat(_this.machine.id, \"'.\"));\n                }\n\n                return;\n              }\n\n              var resolvedData = data ? mapContext(data, context, _event) : undefined;\n\n              if (typeof serviceCreator === 'string') {\n                // TODO: warn\n                return;\n              }\n\n              var source = isFunction(serviceCreator) ? serviceCreator(context, _event.data, {\n                data: resolvedData,\n                src: invokeSource,\n                meta: activity.meta\n              }) : serviceCreator;\n\n              if (!source) {\n                // TODO: warn?\n                return;\n              }\n\n              var options = void 0;\n\n              if (isMachine(source)) {\n                source = resolvedData ? source.withContext(resolvedData) : source;\n                options = {\n                  autoForward: autoForward\n                };\n              }\n\n              _this.spawn(source, id, options);\n            } else {\n              _this.spawnActivity(activity);\n            }\n\n            break;\n          }\n\n        case stop:\n          {\n            _this.stopChild(action.activity.id);\n\n            break;\n          }\n\n        case log:\n          var _a = action,\n              label = _a.label,\n              value = _a.value;\n\n          if (label) {\n            _this.logger(label, value);\n          } else {\n            _this.logger(value);\n          }\n\n          break;\n\n        default:\n          if (!IS_PRODUCTION) {\n            warn(false, \"No implementation found for action type '\".concat(action.type, \"'\"));\n          }\n\n          break;\n      }\n    };\n\n    var resolvedOptions = __assign(__assign({}, Interpreter.defaultOptions), options);\n\n    var clock = resolvedOptions.clock,\n        logger = resolvedOptions.logger,\n        parent = resolvedOptions.parent,\n        id = resolvedOptions.id;\n    var resolvedId = id !== undefined ? id : machine.id;\n    this.id = resolvedId;\n    this.logger = logger;\n    this.clock = clock;\n    this.parent = parent;\n    this.options = resolvedOptions;\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n    this.sessionId = registry.bookId();\n  }\n\n  Object.defineProperty(Interpreter.prototype, \"initialState\", {\n    get: function () {\n      var _this = this;\n\n      if (this._initialState) {\n        return this._initialState;\n      }\n\n      return provide(this, function () {\n        _this._initialState = _this.machine.initialState;\n        return _this._initialState;\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Interpreter.prototype, \"state\", {\n    /**\r\n     * @deprecated Use `.getSnapshot()` instead.\r\n     */\n    get: function () {\n      if (!IS_PRODUCTION) {\n        warn(this.status !== InterpreterStatus.NotStarted, \"Attempted to read state from uninitialized service '\".concat(this.id, \"'. Make sure the service is started first.\"));\n      }\n\n      return this._state;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Executes the actions of the given state, with that state's `context` and `event`.\r\n   *\r\n   * @param state The state whose actions will be executed\r\n   * @param actionsConfig The action implementations to use\r\n   */\n\n  Interpreter.prototype.execute = function (state, actionsConfig) {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(state.actions), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var action = _c.value;\n        this.exec(action, state, actionsConfig);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.update = function (state, _event) {\n    var e_2, _a, e_3, _b, e_4, _c, e_5, _d;\n\n    var _this = this; // Attach session ID to state\n\n\n    state._sessionid = this.sessionId; // Update state\n\n    this._state = state; // Execute actions\n\n    if ((!this.machine.config.predictableActionArguments || // this is currently required to execute initial actions as the `initialState` gets cached\n    // we can't just recompute it (and execute actions while doing so) because we try to preserve identity of actors created within initial assigns\n    _event === initEvent) && this.options.execute) {\n      this.execute(this.state);\n    } else {\n      var item = void 0;\n\n      while (item = this._outgoingQueue.shift()) {\n        item[0].send(item[1]);\n      }\n    } // Update children\n\n\n    this.children.forEach(function (child) {\n      _this.state.children[child.id] = child;\n    }); // Dev tools\n\n    if (this.devTools) {\n      this.devTools.send(_event.data, state);\n    } // Execute listeners\n\n\n    if (state.event) {\n      try {\n        for (var _e = __values(this.eventListeners), _f = _e.next(); !_f.done; _f = _e.next()) {\n          var listener = _f.value;\n          listener(state.event);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_f && !_f.done && (_a = _e.return)) _a.call(_e);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    }\n\n    try {\n      for (var _g = __values(this.listeners), _h = _g.next(); !_h.done; _h = _g.next()) {\n        var listener = _h.value;\n        listener(state, state.event);\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    try {\n      for (var _j = __values(this.contextListeners), _k = _j.next(); !_k.done; _k = _j.next()) {\n        var contextListener = _k.value;\n        contextListener(this.state.context, this.state.history ? this.state.history.context : undefined);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_k && !_k.done && (_c = _j.return)) _c.call(_j);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    if (this.state.done) {\n      // get final child state node\n      var finalChildStateNode = state.configuration.find(function (sn) {\n        return sn.type === 'final' && sn.parent === _this.machine;\n      });\n      var doneData = finalChildStateNode && finalChildStateNode.doneData ? mapContext(finalChildStateNode.doneData, state.context, _event) : undefined;\n      this._doneEvent = doneInvoke(this.id, doneData);\n\n      try {\n        for (var _l = __values(this.doneListeners), _m = _l.next(); !_m.done; _m = _l.next()) {\n          var listener = _m.value;\n          listener(this._doneEvent);\n        }\n      } catch (e_5_1) {\n        e_5 = {\n          error: e_5_1\n        };\n      } finally {\n        try {\n          if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n        } finally {\n          if (e_5) throw e_5.error;\n        }\n      }\n\n      this._stop();\n\n      this._stopChildren();\n\n      registry.free(this.sessionId);\n    }\n  };\n  /*\r\n   * Adds a listener that is notified whenever a state transition happens. The listener is called with\r\n   * the next state and the event object that caused the state transition.\r\n   *\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onTransition = function (listener) {\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this.status === InterpreterStatus.Running) {\n      listener(this.state, this.state.event);\n    }\n\n    return this;\n  };\n\n  Interpreter.prototype.subscribe = function (nextListenerOrObserver, _, // TODO: error listener\n  completeListener) {\n    var _this = this;\n\n    var observer = toObserver(nextListenerOrObserver, _, completeListener);\n    this.listeners.add(observer.next); // Send current state to listener\n\n    if (this.status !== InterpreterStatus.NotStarted) {\n      observer.next(this.state);\n    }\n\n    var completeOnce = function () {\n      _this.doneListeners.delete(completeOnce);\n\n      _this.stopListeners.delete(completeOnce);\n\n      observer.complete();\n    };\n\n    if (this.status === InterpreterStatus.Stopped) {\n      observer.complete();\n    } else {\n      this.onDone(completeOnce);\n      this.onStop(completeOnce);\n    }\n\n    return {\n      unsubscribe: function () {\n        _this.listeners.delete(observer.next);\n\n        _this.doneListeners.delete(completeOnce);\n\n        _this.stopListeners.delete(completeOnce);\n      }\n    };\n  };\n  /**\r\n   * Adds an event listener that is notified whenever an event is sent to the running interpreter.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onEvent = function (listener) {\n    this.eventListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds an event listener that is notified whenever a `send` event occurs.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onSend = function (listener) {\n    this.sendListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a context listener that is notified whenever the state context changes.\r\n   * @param listener The context listener\r\n   */\n\n\n  Interpreter.prototype.onChange = function (listener) {\n    this.contextListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a listener that is notified when the machine is stopped.\r\n   * @param listener The listener\r\n   */\n\n\n  Interpreter.prototype.onStop = function (listener) {\n    this.stopListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a state listener that is notified when the statechart has reached its final state.\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onDone = function (listener) {\n    if (this.status === InterpreterStatus.Stopped && this._doneEvent) {\n      listener(this._doneEvent);\n    } else {\n      this.doneListeners.add(listener);\n    }\n\n    return this;\n  };\n  /**\r\n   * Removes a listener.\r\n   * @param listener The listener to remove\r\n   */\n\n\n  Interpreter.prototype.off = function (listener) {\n    this.listeners.delete(listener);\n    this.eventListeners.delete(listener);\n    this.sendListeners.delete(listener);\n    this.stopListeners.delete(listener);\n    this.doneListeners.delete(listener);\n    this.contextListeners.delete(listener);\n    return this;\n  };\n  /**\r\n   * Starts the interpreter from the given state, or the initial state.\r\n   * @param initialState The state to start the statechart from\r\n   */\n\n\n  Interpreter.prototype.start = function (initialState) {\n    var _this = this;\n\n    if (this.status === InterpreterStatus.Running) {\n      // Do not restart the service if it is already started\n      return this;\n    } // yes, it's a hack but we need the related cache to be populated for some things to work (like delayed transitions)\n    // this is usually called by `machine.getInitialState` but if we rehydrate from a state we might bypass this call\n    // we also don't want to call this method here as it resolves the full initial state which might involve calling assign actions\n    // and that could potentially lead to some unwanted side-effects (even such as creating some rogue actors)\n\n\n    this.machine._init();\n\n    registry.register(this.sessionId, this);\n    this.initialized = true;\n    this.status = InterpreterStatus.Running;\n    var resolvedState = initialState === undefined ? this.initialState : provide(this, function () {\n      return isStateConfig(initialState) ? _this.machine.resolveState(initialState) : _this.machine.resolveState(State.from(initialState, _this.machine.context));\n    });\n\n    if (this.options.devTools) {\n      this.attachDev();\n    }\n\n    this.scheduler.initialize(function () {\n      _this.update(resolvedState, initEvent);\n    });\n    return this;\n  };\n\n  Interpreter.prototype._stopChildren = function () {\n    // TODO: think about converting those to actions\n    this.children.forEach(function (child) {\n      if (isFunction(child.stop)) {\n        child.stop();\n      }\n    });\n    this.children.clear();\n  };\n\n  Interpreter.prototype._stop = function () {\n    var e_6, _a, e_7, _b, e_8, _c, e_9, _d, e_10, _e;\n\n    try {\n      for (var _f = __values(this.listeners), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var listener = _g.value;\n        this.listeners.delete(listener);\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    try {\n      for (var _h = __values(this.stopListeners), _j = _h.next(); !_j.done; _j = _h.next()) {\n        var listener = _j.value; // call listener, then remove\n\n        listener();\n        this.stopListeners.delete(listener);\n      }\n    } catch (e_7_1) {\n      e_7 = {\n        error: e_7_1\n      };\n    } finally {\n      try {\n        if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n      } finally {\n        if (e_7) throw e_7.error;\n      }\n    }\n\n    try {\n      for (var _k = __values(this.contextListeners), _l = _k.next(); !_l.done; _l = _k.next()) {\n        var listener = _l.value;\n        this.contextListeners.delete(listener);\n      }\n    } catch (e_8_1) {\n      e_8 = {\n        error: e_8_1\n      };\n    } finally {\n      try {\n        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n      } finally {\n        if (e_8) throw e_8.error;\n      }\n    }\n\n    try {\n      for (var _m = __values(this.doneListeners), _o = _m.next(); !_o.done; _o = _m.next()) {\n        var listener = _o.value;\n        this.doneListeners.delete(listener);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n\n    if (!this.initialized) {\n      // Interpreter already stopped; do nothing\n      return this;\n    }\n\n    this.initialized = false;\n    this.status = InterpreterStatus.Stopped;\n    this._initialState = undefined;\n\n    try {\n      // we are going to stop within the current sync frame\n      // so we can safely just cancel this here as nothing async should be fired anyway\n      for (var _p = __values(Object.keys(this.delayedEventsMap)), _q = _p.next(); !_q.done; _q = _p.next()) {\n        var key = _q.value;\n        this.clock.clearTimeout(this.delayedEventsMap[key]);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (_q && !_q.done && (_e = _p.return)) _e.call(_p);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    } // clear everything that might be enqueued\n\n\n    this.scheduler.clear();\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n  };\n  /**\r\n   * Stops the interpreter and unsubscribe all listeners.\r\n   *\r\n   * This will also notify the `onStop` listeners.\r\n   */\n\n\n  Interpreter.prototype.stop = function () {\n    // TODO: add warning for stopping non-root interpreters\n    var _this = this; // grab the current scheduler as it will be replaced in _stop\n\n\n    var scheduler = this.scheduler;\n\n    this._stop(); // let what is currently processed to be finished\n\n\n    scheduler.schedule(function () {\n      var _a;\n\n      if ((_a = _this._state) === null || _a === void 0 ? void 0 : _a.done) {\n        return;\n      } // it feels weird to handle this here but we need to handle this even slightly \"out of band\"\n\n\n      var _event = toSCXMLEvent({\n        type: 'xstate.stop'\n      });\n\n      var nextState = provide(_this, function () {\n        var exitActions = flatten(__spreadArray([], __read(_this.state.configuration), false).sort(function (a, b) {\n          return b.order - a.order;\n        }).map(function (stateNode) {\n          return toActionObjects(stateNode.onExit, _this.machine.options.actions);\n        }));\n\n        var _a = __read(resolveActions(_this.machine, _this.state, _this.state.context, _event, [{\n          type: 'exit',\n          actions: exitActions\n        }], _this.machine.config.predictableActionArguments ? _this._exec : undefined, _this.machine.config.predictableActionArguments || _this.machine.config.preserveActionOrder), 2),\n            resolvedActions = _a[0],\n            updatedContext = _a[1];\n\n        var newState = new State({\n          value: _this.state.value,\n          context: updatedContext,\n          _event: _event,\n          _sessionid: _this.sessionId,\n          historyValue: undefined,\n          history: _this.state,\n          actions: resolvedActions.filter(function (action) {\n            return !isRaisableAction(action);\n          }),\n          activities: {},\n          events: [],\n          configuration: [],\n          transitions: [],\n          children: {},\n          done: _this.state.done,\n          tags: _this.state.tags,\n          machine: _this.machine\n        });\n        newState.changed = true;\n        return newState;\n      });\n\n      _this.update(nextState, _event);\n\n      _this._stopChildren();\n\n      registry.free(_this.sessionId);\n    });\n    return this;\n  };\n\n  Interpreter.prototype.batch = function (events) {\n    var _this = this;\n\n    if (this.status === InterpreterStatus.NotStarted && this.options.deferEvents) {\n      // tslint:disable-next-line:no-console\n      if (!IS_PRODUCTION) {\n        warn(false, \"\".concat(events.length, \" event(s) were sent to uninitialized service \\\"\").concat(this.machine.id, \"\\\" and are deferred. Make sure .start() is called for this service.\\nEvent: \").concat(JSON.stringify(event)));\n      }\n    } else if (this.status !== InterpreterStatus.Running) {\n      throw new Error( // tslint:disable-next-line:max-line-length\n      \"\".concat(events.length, \" event(s) were sent to uninitialized service \\\"\").concat(this.machine.id, \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\"));\n    }\n\n    if (!events.length) {\n      return;\n    }\n\n    var exec = !!this.machine.config.predictableActionArguments && this._exec;\n    this.scheduler.schedule(function () {\n      var e_11, _a;\n\n      var nextState = _this.state;\n      var batchChanged = false;\n      var batchedActions = [];\n\n      var _loop_1 = function (event_1) {\n        var _event = toSCXMLEvent(event_1);\n\n        _this.forward(_event);\n\n        nextState = provide(_this, function () {\n          return _this.machine.transition(nextState, _event, undefined, exec || undefined);\n        });\n        batchedActions.push.apply(batchedActions, __spreadArray([], __read(_this.machine.config.predictableActionArguments ? nextState.actions : nextState.actions.map(function (a) {\n          return bindActionToState(a, nextState);\n        })), false));\n        batchChanged = batchChanged || !!nextState.changed;\n      };\n\n      try {\n        for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n          var event_1 = events_1_1.value;\n\n          _loop_1(event_1);\n        }\n      } catch (e_11_1) {\n        e_11 = {\n          error: e_11_1\n        };\n      } finally {\n        try {\n          if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n        } finally {\n          if (e_11) throw e_11.error;\n        }\n      }\n\n      nextState.changed = batchChanged;\n      nextState.actions = batchedActions;\n\n      _this.update(nextState, toSCXMLEvent(events[events.length - 1]));\n    });\n  };\n  /**\r\n   * Returns a send function bound to this interpreter instance.\r\n   *\r\n   * @param event The event to be sent by the sender.\r\n   */\n\n\n  Interpreter.prototype.sender = function (event) {\n    return this.send.bind(this, event);\n  };\n\n  Interpreter.prototype._nextState = function (event, exec) {\n    var _this = this;\n\n    if (exec === void 0) {\n      exec = !!this.machine.config.predictableActionArguments && this._exec;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    if (_event.name.indexOf(errorPlatform) === 0 && !this.state.nextEvents.some(function (nextEvent) {\n      return nextEvent.indexOf(errorPlatform) === 0;\n    })) {\n      throw _event.data.data;\n    }\n\n    var nextState = provide(this, function () {\n      return _this.machine.transition(_this.state, _event, undefined, exec || undefined);\n    });\n    return nextState;\n  };\n  /**\r\n   * Returns the next state given the interpreter's current state and the event.\r\n   *\r\n   * This is a pure method that does _not_ update the interpreter's state.\r\n   *\r\n   * @param event The event to determine the next state\r\n   */\n\n\n  Interpreter.prototype.nextState = function (event) {\n    return this._nextState(event, false);\n  };\n\n  Interpreter.prototype.forward = function (event) {\n    var e_12, _a;\n\n    try {\n      for (var _b = __values(this.forwardTo), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        var child = this.children.get(id);\n\n        if (!child) {\n          throw new Error(\"Unable to forward event '\".concat(event, \"' from interpreter '\").concat(this.id, \"' to nonexistant child '\").concat(id, \"'.\"));\n        }\n\n        child.send(event);\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.defer = function (sendAction) {\n    var _this = this;\n\n    var timerId = this.clock.setTimeout(function () {\n      if ('to' in sendAction && sendAction.to) {\n        _this.sendTo(sendAction._event, sendAction.to, true);\n      } else {\n        _this.send(sendAction._event);\n      }\n    }, sendAction.delay);\n\n    if (sendAction.id) {\n      this.delayedEventsMap[sendAction.id] = timerId;\n    }\n  };\n\n  Interpreter.prototype.cancel = function (sendId) {\n    this.clock.clearTimeout(this.delayedEventsMap[sendId]);\n    delete this.delayedEventsMap[sendId];\n  };\n\n  Interpreter.prototype.exec = function (action, state, actionFunctionMap) {\n    if (actionFunctionMap === void 0) {\n      actionFunctionMap = this.machine.options.actions;\n    }\n\n    this._exec(action, state.context, state._event, actionFunctionMap);\n  };\n\n  Interpreter.prototype.removeChild = function (childId) {\n    var _a;\n\n    this.children.delete(childId);\n    this.forwardTo.delete(childId); // this.state might not exist at the time this is called,\n    // such as when a child is added then removed while initializing the state\n\n    (_a = this.state) === null || _a === void 0 ? true : delete _a.children[childId];\n  };\n\n  Interpreter.prototype.stopChild = function (childId) {\n    var child = this.children.get(childId);\n\n    if (!child) {\n      return;\n    }\n\n    this.removeChild(childId);\n\n    if (isFunction(child.stop)) {\n      child.stop();\n    }\n  };\n\n  Interpreter.prototype.spawn = function (entity, name, options) {\n    if (this.status !== InterpreterStatus.Running) {\n      return createDeferredActor(entity, name);\n    }\n\n    if (isPromiseLike(entity)) {\n      return this.spawnPromise(Promise.resolve(entity), name);\n    } else if (isFunction(entity)) {\n      return this.spawnCallback(entity, name);\n    } else if (isSpawnedActor(entity)) {\n      return this.spawnActor(entity, name);\n    } else if (isObservable(entity)) {\n      return this.spawnObservable(entity, name);\n    } else if (isMachine(entity)) {\n      return this.spawnMachine(entity, __assign(__assign({}, options), {\n        id: name\n      }));\n    } else if (isBehavior(entity)) {\n      return this.spawnBehavior(entity, name);\n    } else {\n      throw new Error(\"Unable to spawn entity \\\"\".concat(name, \"\\\" of type \\\"\").concat(typeof entity, \"\\\".\"));\n    }\n  };\n\n  Interpreter.prototype.spawnMachine = function (machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var childService = new Interpreter(machine, __assign(__assign({}, this.options), {\n      parent: this,\n      id: options.id || machine.id\n    }));\n\n    var resolvedOptions = __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), options);\n\n    if (resolvedOptions.sync) {\n      childService.onTransition(function (state) {\n        _this.send(update, {\n          state: state,\n          id: childService.id\n        });\n      });\n    }\n\n    var actor = childService;\n    this.children.set(childService.id, actor);\n\n    if (resolvedOptions.autoForward) {\n      this.forwardTo.add(childService.id);\n    }\n\n    childService.onDone(function (doneEvent) {\n      _this.removeChild(childService.id);\n\n      _this.send(toSCXMLEvent(doneEvent, {\n        origin: childService.id\n      }));\n    }).start();\n    return actor;\n  };\n\n  Interpreter.prototype.spawnBehavior = function (behavior, id) {\n    var actorRef = spawnBehavior(behavior, {\n      id: id,\n      parent: this\n    });\n    this.children.set(id, actorRef);\n    return actorRef;\n  };\n\n  Interpreter.prototype.spawnPromise = function (promise, id) {\n    var _a;\n\n    var _this = this;\n\n    var canceled = false;\n    var resolvedData;\n    promise.then(function (response) {\n      if (!canceled) {\n        resolvedData = response;\n\n        _this.removeChild(id);\n\n        _this.send(toSCXMLEvent(doneInvoke(id, response), {\n          origin: id\n        }));\n      }\n    }, function (errorData) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        var errorEvent = error(id, errorData);\n\n        try {\n          // Send \"error.platform.id\" to this (parent).\n          _this.send(toSCXMLEvent(errorEvent, {\n            origin: id\n          }));\n        } catch (error) {\n          reportUnhandledExceptionOnInvocation(errorData, error, id);\n\n          if (_this.devTools) {\n            _this.devTools.send(errorEvent, _this.state);\n          }\n\n          if (_this.machine.strict) {\n            // it would be better to always stop the state machine if unhandled\n            // exception/promise rejection happens but because we don't want to\n            // break existing code so enforce it on strict mode only especially so\n            // because documentation says that onError is optional\n            _this.stop();\n          }\n        }\n      }\n    });\n    var actor = (_a = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        var observer = toObserver(next, handleError, complete);\n        var unsubscribed = false;\n        promise.then(function (response) {\n          if (unsubscribed) {\n            return;\n          }\n\n          observer.next(response);\n\n          if (unsubscribed) {\n            return;\n          }\n\n          observer.complete();\n        }, function (err) {\n          if (unsubscribed) {\n            return;\n          }\n\n          observer.error(err);\n        });\n        return {\n          unsubscribe: function () {\n            return unsubscribed = true;\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      },\n      getSnapshot: function () {\n        return resolvedData;\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a);\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnCallback = function (callback, id) {\n    var _a;\n\n    var _this = this;\n\n    var canceled = false;\n    var receivers = new Set();\n    var listeners = new Set();\n    var emitted;\n\n    var receive = function (e) {\n      emitted = e;\n      listeners.forEach(function (listener) {\n        return listener(e);\n      });\n\n      if (canceled) {\n        return;\n      }\n\n      _this.send(toSCXMLEvent(e, {\n        origin: id\n      }));\n    };\n\n    var callbackStop;\n\n    try {\n      callbackStop = callback(receive, function (newListener) {\n        receivers.add(newListener);\n      });\n    } catch (err) {\n      this.send(error(id, err));\n    }\n\n    if (isPromiseLike(callbackStop)) {\n      // it turned out to be an async function, can't reliably check this before calling `callback`\n      // because transpiled async functions are not recognizable\n      return this.spawnPromise(callbackStop, id);\n    }\n\n    var actor = (_a = {\n      id: id,\n      send: function (event) {\n        return receivers.forEach(function (receiver) {\n          return receiver(event);\n        });\n      },\n      subscribe: function (next) {\n        var observer = toObserver(next);\n        listeners.add(observer.next);\n        return {\n          unsubscribe: function () {\n            listeners.delete(observer.next);\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n\n        if (isFunction(callbackStop)) {\n          callbackStop();\n        }\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      },\n      getSnapshot: function () {\n        return emitted;\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a);\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnObservable = function (source, id) {\n    var _a;\n\n    var _this = this;\n\n    var emitted;\n    var subscription = source.subscribe(function (value) {\n      emitted = value;\n\n      _this.send(toSCXMLEvent(value, {\n        origin: id\n      }));\n    }, function (err) {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(error(id, err), {\n        origin: id\n      }));\n    }, function () {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(doneInvoke(id), {\n        origin: id\n      }));\n    });\n    var actor = (_a = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        return source.subscribe(next, handleError, complete);\n      },\n      stop: function () {\n        return subscription.unsubscribe();\n      },\n      getSnapshot: function () {\n        return emitted;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a);\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActor = function (actor, name) {\n    this.children.set(name, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActivity = function (activity) {\n    var implementation = this.machine.options && this.machine.options.activities ? this.machine.options.activities[activity.type] : undefined;\n\n    if (!implementation) {\n      if (!IS_PRODUCTION) {\n        warn(false, \"No implementation found for activity '\".concat(activity.type, \"'\"));\n      } // tslint:disable-next-line:no-console\n\n\n      return;\n    } // Start implementation\n\n\n    var dispose = implementation(this.state.context, activity);\n    this.spawnEffect(activity.id, dispose);\n  };\n\n  Interpreter.prototype.spawnEffect = function (id, dispose) {\n    var _a;\n\n    this.children.set(id, (_a = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function () {\n        return {\n          unsubscribe: function () {\n            return void 0;\n          }\n        };\n      },\n      stop: dispose || undefined,\n      getSnapshot: function () {\n        return undefined;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a));\n  };\n\n  Interpreter.prototype.attachDev = function () {\n    var global = getGlobal();\n\n    if (this.options.devTools && global) {\n      if (global.__REDUX_DEVTOOLS_EXTENSION__) {\n        var devToolsOptions = typeof this.options.devTools === 'object' ? this.options.devTools : undefined;\n        this.devTools = global.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({\n          name: this.id,\n          autoPause: true,\n          stateSanitizer: function (state) {\n            return {\n              value: state.value,\n              context: state.context,\n              actions: state.actions\n            };\n          }\n        }, devToolsOptions), {\n          features: __assign({\n            jump: false,\n            skip: false\n          }, devToolsOptions ? devToolsOptions.features : undefined)\n        }), this.machine);\n        this.devTools.init(this.state);\n      } // add XState-specific dev tooling hook\n\n\n      registerService(this);\n    }\n  };\n\n  Interpreter.prototype.toJSON = function () {\n    return {\n      id: this.id\n    };\n  };\n\n  Interpreter.prototype[symbolObservable] = function () {\n    return this;\n  };\n\n  Interpreter.prototype.getSnapshot = function () {\n    if (this.status === InterpreterStatus.NotStarted) {\n      return this.initialState;\n    }\n\n    return this._state;\n  };\n  /**\r\n   * The default interpreter options:\r\n   *\r\n   * - `clock` uses the global `setTimeout` and `clearTimeout` functions\r\n   * - `logger` uses the global `console.log()` method\r\n   */\n\n\n  Interpreter.defaultOptions = {\n    execute: true,\n    deferEvents: true,\n    clock: {\n      setTimeout: function (fn, ms) {\n        return setTimeout(fn, ms);\n      },\n      clearTimeout: function (id) {\n        return clearTimeout(id);\n      }\n    },\n    logger: /*#__PURE__*/console.log.bind(console),\n    devTools: false\n  };\n  Interpreter.interpret = interpret;\n  return Interpreter;\n}();\n\nvar resolveSpawnOptions = function (nameOrOptions) {\n  if (isString(nameOrOptions)) {\n    return __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n      name: nameOrOptions\n    });\n  }\n\n  return __assign(__assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n    name: uniqueId()\n  }), nameOrOptions);\n};\n\nfunction spawn(entity, nameOrOptions) {\n  var resolvedOptions = resolveSpawnOptions(nameOrOptions);\n  return consume(function (service) {\n    if (!IS_PRODUCTION) {\n      var isLazyEntity = isMachine(entity) || isFunction(entity);\n      warn(!!service || isLazyEntity, \"Attempted to spawn an Actor (ID: \\\"\".concat(isMachine(entity) ? entity.id : 'undefined', \"\\\") outside of a service. This will have no effect.\"));\n    }\n\n    if (service) {\n      return service.spawn(entity, resolvedOptions.name, resolvedOptions);\n    } else {\n      return createDeferredActor(entity, resolvedOptions.name);\n    }\n  });\n}\n/**\r\n * Creates a new Interpreter instance for the given machine with the provided options, if any.\r\n *\r\n * @param machine The machine to interpret\r\n * @param options Interpreter options\r\n */\n\n\nfunction interpret(machine, options) {\n  var interpreter = new Interpreter(machine, options);\n  return interpreter;\n}\n\nexport { Interpreter, InterpreterStatus, interpret, spawn };","map":{"version":3,"names":["__values","__spreadArray","__read","__assign","SpecialTargets","ActionTypes","isStateConfig","State","bindActionToState","errorPlatform","update","error","error$1","log","stop","start","cancel","send","raise","initEvent","doneInvoke","toActionObjects","resolveActions","getActionFunction","IS_PRODUCTION","warn","mapContext","toObserver","isFunction","toSCXMLEvent","flatten","isRaisableAction","isPromiseLike","isObservable","isMachine","isBehavior","reportUnhandledExceptionOnInvocation","symbolObservable","isArray","toEventObject","isString","isActor","toInvokeSource","uniqueId","Scheduler","createDeferredActor","isSpawnedActor","registry","getGlobal","registerService","provide","consume","spawnBehavior","DEFAULT_SPAWN_OPTIONS","sync","autoForward","InterpreterStatus","Interpreter","machine","options","defaultOptions","_this","delayedEventsMap","listeners","Set","contextListeners","stopListeners","doneListeners","eventListeners","sendListeners","initialized","status","NotStarted","children","Map","forwardTo","_outgoingQueue","init","event","payload","batch","state","_event","Stopped","concat","name","id","JSON","stringify","data","Running","deferEvents","Error","scheduler","schedule","forward","nextState","_nextState","_state","sendTo","to","immediate","isParent","parent","Parent","target","Internal","get","undefined","type","done","scxmlEvent","origin","sessionId","config","predictableActionArguments","push","_exec","action","context","actionFunctionMap","actions","actionOrExec","exec","err","sendAction_1","defer","sendAction","delay","sendId","activity","activities","Invoke","invokeSource","src","serviceCreator","services","resolvedData","source","meta","withContext","spawn","spawnActivity","stopChild","_a","label","value","logger","resolvedOptions","clock","resolvedId","bookId","Object","defineProperty","prototype","_initialState","initialState","enumerable","configurable","execute","actionsConfig","e_1","_b","_c","next","e_1_1","return","call","e_2","e_3","e_4","e_5","_d","_sessionid","item","shift","forEach","child","devTools","_e","_f","listener","e_2_1","_g","_h","e_3_1","_j","_k","contextListener","history","e_4_1","finalChildStateNode","configuration","find","sn","doneData","_doneEvent","_l","_m","e_5_1","_stop","_stopChildren","free","onTransition","add","subscribe","nextListenerOrObserver","_","completeListener","observer","completeOnce","delete","complete","onDone","onStop","unsubscribe","onEvent","onSend","onChange","off","_init","register","resolvedState","resolveState","from","attachDev","initialize","clear","e_6","e_7","e_8","e_9","e_10","e_6_1","e_7_1","e_8_1","_o","e_9_1","_p","keys","_q","key","clearTimeout","e_10_1","exitActions","sort","a","b","order","map","stateNode","onExit","preserveActionOrder","resolvedActions","updatedContext","newState","historyValue","filter","events","transitions","tags","changed","length","e_11","batchChanged","batchedActions","_loop_1","event_1","transition","apply","events_1","events_1_1","e_11_1","sender","bind","indexOf","nextEvents","some","nextEvent","e_12","e_12_1","timerId","setTimeout","removeChild","childId","entity","spawnPromise","Promise","resolve","spawnCallback","spawnActor","spawnObservable","spawnMachine","childService","actor","set","doneEvent","behavior","actorRef","promise","canceled","then","response","errorData","errorEvent","strict","handleError","unsubscribed","toJSON","getSnapshot","callback","receivers","emitted","receive","e","callbackStop","newListener","receiver","subscription","implementation","dispose","spawnEffect","global","__REDUX_DEVTOOLS_EXTENSION__","devToolsOptions","connect","autoPause","stateSanitizer","features","jump","skip","fn","ms","console","interpret","resolveSpawnOptions","nameOrOptions","service","isLazyEntity","interpreter"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/xstate/es/interpreter.js"],"sourcesContent":["import { __values, __spreadArray, __read, __assign } from './_virtual/_tslib.js';\nimport { SpecialTargets, ActionTypes } from './types.js';\nimport { isStateConfig, State, bindActionToState } from './State.js';\nimport { errorPlatform, update, error as error$1, log, stop, start, cancel, send, raise } from './actionTypes.js';\nimport { initEvent, doneInvoke, toActionObjects, resolveActions, error, getActionFunction } from './actions.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { warn, mapContext, toObserver, isFunction, toSCXMLEvent, flatten, isRaisableAction, isPromiseLike, isObservable, isMachine, isBehavior, reportUnhandledExceptionOnInvocation, symbolObservable, isArray, toEventObject, isString, isActor, toInvokeSource, uniqueId } from './utils.js';\nimport { Scheduler } from './scheduler.js';\nimport { createDeferredActor, isSpawnedActor } from './Actor.js';\nimport { registry } from './registry.js';\nimport { getGlobal, registerService } from './devTools.js';\nimport { provide, consume } from './serviceScope.js';\nimport { spawnBehavior } from './behaviors.js';\n\nvar DEFAULT_SPAWN_OPTIONS = {\n  sync: false,\n  autoForward: false\n};\nvar InterpreterStatus;\n\n(function (InterpreterStatus) {\n  InterpreterStatus[InterpreterStatus[\"NotStarted\"] = 0] = \"NotStarted\";\n  InterpreterStatus[InterpreterStatus[\"Running\"] = 1] = \"Running\";\n  InterpreterStatus[InterpreterStatus[\"Stopped\"] = 2] = \"Stopped\";\n})(InterpreterStatus || (InterpreterStatus = {}));\n\nvar Interpreter =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new Interpreter instance (i.e., service) for the given machine with the provided options, if any.\r\n   *\r\n   * @param machine The machine to be interpreted\r\n   * @param options Interpreter options\r\n   */\n  function Interpreter(machine, options) {\n    if (options === void 0) {\n      options = Interpreter.defaultOptions;\n    }\n\n    var _this = this;\n\n    this.machine = machine;\n    this.delayedEventsMap = {};\n    this.listeners = new Set();\n    this.contextListeners = new Set();\n    this.stopListeners = new Set();\n    this.doneListeners = new Set();\n    this.eventListeners = new Set();\n    this.sendListeners = new Set();\n    /**\r\n     * Whether the service is started.\r\n     */\n\n    this.initialized = false;\n    this.status = InterpreterStatus.NotStarted;\n    this.children = new Map();\n    this.forwardTo = new Set();\n    this._outgoingQueue = [];\n    /**\r\n     * Alias for Interpreter.prototype.start\r\n     */\n\n    this.init = this.start;\n    /**\r\n     * Sends an event to the running interpreter to trigger a transition.\r\n     *\r\n     * An array of events (batched) can be sent as well, which will send all\r\n     * batched events to the running interpreter. The listeners will be\r\n     * notified only **once** when all events are processed.\r\n     *\r\n     * @param event The event(s) to send\r\n     */\n\n    this.send = function (event, payload) {\n      if (isArray(event)) {\n        _this.batch(event);\n\n        return _this.state;\n      }\n\n      var _event = toSCXMLEvent(toEventObject(event, payload));\n\n      if (_this.status === InterpreterStatus.Stopped) {\n        // do nothing\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\".concat(_event.name, \"\\\" was sent to stopped service \\\"\").concat(_this.machine.id, \"\\\". This service has already reached its final state, and will not transition.\\nEvent: \").concat(JSON.stringify(_event.data)));\n        }\n\n        return _this.state;\n      }\n\n      if (_this.status !== InterpreterStatus.Running && !_this.options.deferEvents) {\n        throw new Error(\"Event \\\"\".concat(_event.name, \"\\\" was sent to uninitialized service \\\"\").concat(_this.machine.id // tslint:disable-next-line:max-line-length\n        , \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\\nEvent: \").concat(JSON.stringify(_event.data)));\n      }\n\n      _this.scheduler.schedule(function () {\n        // Forward copy of event to child actors\n        _this.forward(_event);\n\n        var nextState = _this._nextState(_event);\n\n        _this.update(nextState, _event);\n      });\n\n      return _this._state; // TODO: deprecate (should return void)\n      // tslint:disable-next-line:semicolon\n    };\n\n    this.sendTo = function (event, to, immediate) {\n      var isParent = _this.parent && (to === SpecialTargets.Parent || _this.parent.id === to);\n      var target = isParent ? _this.parent : isString(to) ? to === SpecialTargets.Internal ? _this : _this.children.get(to) || registry.get(to) : isActor(to) ? to : undefined;\n\n      if (!target) {\n        if (!isParent) {\n          throw new Error(\"Unable to send event to child '\".concat(to, \"' from service '\").concat(_this.id, \"'.\"));\n        } // tslint:disable-next-line:no-console\n\n\n        if (!IS_PRODUCTION) {\n          warn(false, \"Service '\".concat(_this.id, \"' has no parent: unable to send event \").concat(event.type));\n        }\n\n        return;\n      }\n\n      if ('machine' in target) {\n        // perhaps those events should be rejected in the parent\n        // but atm it doesn't have easy access to all of the information that is required to do it reliably\n        if (_this.status !== InterpreterStatus.Stopped || _this.parent !== target || // we need to send events to the parent from exit handlers of a machine that reached its final state\n        _this.state.done) {\n          // Send SCXML events to machines\n          var scxmlEvent = __assign(__assign({}, event), {\n            name: event.name === error$1 ? \"\".concat(error(_this.id)) : event.name,\n            origin: _this.sessionId\n          });\n\n          if (!immediate && _this.machine.config.predictableActionArguments) {\n            _this._outgoingQueue.push([target, scxmlEvent]);\n          } else {\n            target.send(scxmlEvent);\n          }\n        }\n      } else {\n        // Send normal events to other targets\n        if (!immediate && _this.machine.config.predictableActionArguments) {\n          _this._outgoingQueue.push([target, event.data]);\n        } else {\n          target.send(event.data);\n        }\n      }\n    };\n\n    this._exec = function (action, context, _event, actionFunctionMap) {\n      if (actionFunctionMap === void 0) {\n        actionFunctionMap = _this.machine.options.actions;\n      }\n\n      var actionOrExec = action.exec || getActionFunction(action.type, actionFunctionMap);\n      var exec = isFunction(actionOrExec) ? actionOrExec : actionOrExec ? actionOrExec.exec : action.exec;\n\n      if (exec) {\n        try {\n          return exec(context, _event.data, !_this.machine.config.predictableActionArguments ? {\n            action: action,\n            state: _this.state,\n            _event: _event\n          } : {\n            action: action,\n            _event: _event\n          });\n        } catch (err) {\n          if (_this.parent) {\n            _this.parent.send({\n              type: 'xstate.error',\n              data: err\n            });\n          }\n\n          throw err;\n        }\n      }\n\n      switch (action.type) {\n        case raise:\n          {\n            // if raise action reached the interpreter then it's a delayed one\n            var sendAction_1 = action;\n\n            _this.defer(sendAction_1);\n\n            break;\n          }\n\n        case send:\n          var sendAction = action;\n\n          if (typeof sendAction.delay === 'number') {\n            _this.defer(sendAction);\n\n            return;\n          } else {\n            if (sendAction.to) {\n              _this.sendTo(sendAction._event, sendAction.to, _event === initEvent);\n            } else {\n              _this.send(sendAction._event);\n            }\n          }\n\n          break;\n\n        case cancel:\n          _this.cancel(action.sendId);\n\n          break;\n\n        case start:\n          {\n            if (_this.status !== InterpreterStatus.Running) {\n              return;\n            }\n\n            var activity = action.activity; // If the activity will be stopped right after it's started\n            // (such as in transient states)\n            // don't bother starting the activity.\n\n            if ( // in v4 with `predictableActionArguments` invokes are called eagerly when the `this.state` still points to the previous state\n            !_this.machine.config.predictableActionArguments && !_this.state.activities[activity.id || activity.type]) {\n              break;\n            } // Invoked services\n\n\n            if (activity.type === ActionTypes.Invoke) {\n              var invokeSource = toInvokeSource(activity.src);\n              var serviceCreator = _this.machine.options.services ? _this.machine.options.services[invokeSource.type] : undefined;\n              var id = activity.id,\n                  data = activity.data;\n\n              if (!IS_PRODUCTION) {\n                warn(!('forward' in activity), // tslint:disable-next-line:max-line-length\n                \"`forward` property is deprecated (found in invocation of '\".concat(activity.src, \"' in in machine '\").concat(_this.machine.id, \"'). \") + \"Please use `autoForward` instead.\");\n              }\n\n              var autoForward = 'autoForward' in activity ? activity.autoForward : !!activity.forward;\n\n              if (!serviceCreator) {\n                // tslint:disable-next-line:no-console\n                if (!IS_PRODUCTION) {\n                  warn(false, \"No service found for invocation '\".concat(activity.src, \"' in machine '\").concat(_this.machine.id, \"'.\"));\n                }\n\n                return;\n              }\n\n              var resolvedData = data ? mapContext(data, context, _event) : undefined;\n\n              if (typeof serviceCreator === 'string') {\n                // TODO: warn\n                return;\n              }\n\n              var source = isFunction(serviceCreator) ? serviceCreator(context, _event.data, {\n                data: resolvedData,\n                src: invokeSource,\n                meta: activity.meta\n              }) : serviceCreator;\n\n              if (!source) {\n                // TODO: warn?\n                return;\n              }\n\n              var options = void 0;\n\n              if (isMachine(source)) {\n                source = resolvedData ? source.withContext(resolvedData) : source;\n                options = {\n                  autoForward: autoForward\n                };\n              }\n\n              _this.spawn(source, id, options);\n            } else {\n              _this.spawnActivity(activity);\n            }\n\n            break;\n          }\n\n        case stop:\n          {\n            _this.stopChild(action.activity.id);\n\n            break;\n          }\n\n        case log:\n          var _a = action,\n              label = _a.label,\n              value = _a.value;\n\n          if (label) {\n            _this.logger(label, value);\n          } else {\n            _this.logger(value);\n          }\n\n          break;\n\n        default:\n          if (!IS_PRODUCTION) {\n            warn(false, \"No implementation found for action type '\".concat(action.type, \"'\"));\n          }\n\n          break;\n      }\n    };\n\n    var resolvedOptions = __assign(__assign({}, Interpreter.defaultOptions), options);\n\n    var clock = resolvedOptions.clock,\n        logger = resolvedOptions.logger,\n        parent = resolvedOptions.parent,\n        id = resolvedOptions.id;\n    var resolvedId = id !== undefined ? id : machine.id;\n    this.id = resolvedId;\n    this.logger = logger;\n    this.clock = clock;\n    this.parent = parent;\n    this.options = resolvedOptions;\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n    this.sessionId = registry.bookId();\n  }\n\n  Object.defineProperty(Interpreter.prototype, \"initialState\", {\n    get: function () {\n      var _this = this;\n\n      if (this._initialState) {\n        return this._initialState;\n      }\n\n      return provide(this, function () {\n        _this._initialState = _this.machine.initialState;\n        return _this._initialState;\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Interpreter.prototype, \"state\", {\n    /**\r\n     * @deprecated Use `.getSnapshot()` instead.\r\n     */\n    get: function () {\n      if (!IS_PRODUCTION) {\n        warn(this.status !== InterpreterStatus.NotStarted, \"Attempted to read state from uninitialized service '\".concat(this.id, \"'. Make sure the service is started first.\"));\n      }\n\n      return this._state;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Executes the actions of the given state, with that state's `context` and `event`.\r\n   *\r\n   * @param state The state whose actions will be executed\r\n   * @param actionsConfig The action implementations to use\r\n   */\n\n  Interpreter.prototype.execute = function (state, actionsConfig) {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(state.actions), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var action = _c.value;\n        this.exec(action, state, actionsConfig);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.update = function (state, _event) {\n    var e_2, _a, e_3, _b, e_4, _c, e_5, _d;\n\n    var _this = this; // Attach session ID to state\n\n\n    state._sessionid = this.sessionId; // Update state\n\n    this._state = state; // Execute actions\n\n    if ((!this.machine.config.predictableActionArguments || // this is currently required to execute initial actions as the `initialState` gets cached\n    // we can't just recompute it (and execute actions while doing so) because we try to preserve identity of actors created within initial assigns\n    _event === initEvent) && this.options.execute) {\n      this.execute(this.state);\n    } else {\n      var item = void 0;\n\n      while (item = this._outgoingQueue.shift()) {\n        item[0].send(item[1]);\n      }\n    } // Update children\n\n\n    this.children.forEach(function (child) {\n      _this.state.children[child.id] = child;\n    }); // Dev tools\n\n    if (this.devTools) {\n      this.devTools.send(_event.data, state);\n    } // Execute listeners\n\n\n    if (state.event) {\n      try {\n        for (var _e = __values(this.eventListeners), _f = _e.next(); !_f.done; _f = _e.next()) {\n          var listener = _f.value;\n          listener(state.event);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_f && !_f.done && (_a = _e.return)) _a.call(_e);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    }\n\n    try {\n      for (var _g = __values(this.listeners), _h = _g.next(); !_h.done; _h = _g.next()) {\n        var listener = _h.value;\n        listener(state, state.event);\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    try {\n      for (var _j = __values(this.contextListeners), _k = _j.next(); !_k.done; _k = _j.next()) {\n        var contextListener = _k.value;\n        contextListener(this.state.context, this.state.history ? this.state.history.context : undefined);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_k && !_k.done && (_c = _j.return)) _c.call(_j);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    if (this.state.done) {\n      // get final child state node\n      var finalChildStateNode = state.configuration.find(function (sn) {\n        return sn.type === 'final' && sn.parent === _this.machine;\n      });\n      var doneData = finalChildStateNode && finalChildStateNode.doneData ? mapContext(finalChildStateNode.doneData, state.context, _event) : undefined;\n      this._doneEvent = doneInvoke(this.id, doneData);\n\n      try {\n        for (var _l = __values(this.doneListeners), _m = _l.next(); !_m.done; _m = _l.next()) {\n          var listener = _m.value;\n          listener(this._doneEvent);\n        }\n      } catch (e_5_1) {\n        e_5 = {\n          error: e_5_1\n        };\n      } finally {\n        try {\n          if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n        } finally {\n          if (e_5) throw e_5.error;\n        }\n      }\n\n      this._stop();\n\n      this._stopChildren();\n\n      registry.free(this.sessionId);\n    }\n  };\n  /*\r\n   * Adds a listener that is notified whenever a state transition happens. The listener is called with\r\n   * the next state and the event object that caused the state transition.\r\n   *\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onTransition = function (listener) {\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this.status === InterpreterStatus.Running) {\n      listener(this.state, this.state.event);\n    }\n\n    return this;\n  };\n\n  Interpreter.prototype.subscribe = function (nextListenerOrObserver, _, // TODO: error listener\n  completeListener) {\n    var _this = this;\n\n    var observer = toObserver(nextListenerOrObserver, _, completeListener);\n    this.listeners.add(observer.next); // Send current state to listener\n\n    if (this.status !== InterpreterStatus.NotStarted) {\n      observer.next(this.state);\n    }\n\n    var completeOnce = function () {\n      _this.doneListeners.delete(completeOnce);\n\n      _this.stopListeners.delete(completeOnce);\n\n      observer.complete();\n    };\n\n    if (this.status === InterpreterStatus.Stopped) {\n      observer.complete();\n    } else {\n      this.onDone(completeOnce);\n      this.onStop(completeOnce);\n    }\n\n    return {\n      unsubscribe: function () {\n        _this.listeners.delete(observer.next);\n\n        _this.doneListeners.delete(completeOnce);\n\n        _this.stopListeners.delete(completeOnce);\n      }\n    };\n  };\n  /**\r\n   * Adds an event listener that is notified whenever an event is sent to the running interpreter.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onEvent = function (listener) {\n    this.eventListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds an event listener that is notified whenever a `send` event occurs.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onSend = function (listener) {\n    this.sendListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a context listener that is notified whenever the state context changes.\r\n   * @param listener The context listener\r\n   */\n\n\n  Interpreter.prototype.onChange = function (listener) {\n    this.contextListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a listener that is notified when the machine is stopped.\r\n   * @param listener The listener\r\n   */\n\n\n  Interpreter.prototype.onStop = function (listener) {\n    this.stopListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a state listener that is notified when the statechart has reached its final state.\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onDone = function (listener) {\n    if (this.status === InterpreterStatus.Stopped && this._doneEvent) {\n      listener(this._doneEvent);\n    } else {\n      this.doneListeners.add(listener);\n    }\n\n    return this;\n  };\n  /**\r\n   * Removes a listener.\r\n   * @param listener The listener to remove\r\n   */\n\n\n  Interpreter.prototype.off = function (listener) {\n    this.listeners.delete(listener);\n    this.eventListeners.delete(listener);\n    this.sendListeners.delete(listener);\n    this.stopListeners.delete(listener);\n    this.doneListeners.delete(listener);\n    this.contextListeners.delete(listener);\n    return this;\n  };\n  /**\r\n   * Starts the interpreter from the given state, or the initial state.\r\n   * @param initialState The state to start the statechart from\r\n   */\n\n\n  Interpreter.prototype.start = function (initialState) {\n    var _this = this;\n\n    if (this.status === InterpreterStatus.Running) {\n      // Do not restart the service if it is already started\n      return this;\n    } // yes, it's a hack but we need the related cache to be populated for some things to work (like delayed transitions)\n    // this is usually called by `machine.getInitialState` but if we rehydrate from a state we might bypass this call\n    // we also don't want to call this method here as it resolves the full initial state which might involve calling assign actions\n    // and that could potentially lead to some unwanted side-effects (even such as creating some rogue actors)\n\n\n    this.machine._init();\n\n    registry.register(this.sessionId, this);\n    this.initialized = true;\n    this.status = InterpreterStatus.Running;\n    var resolvedState = initialState === undefined ? this.initialState : provide(this, function () {\n      return isStateConfig(initialState) ? _this.machine.resolveState(initialState) : _this.machine.resolveState(State.from(initialState, _this.machine.context));\n    });\n\n    if (this.options.devTools) {\n      this.attachDev();\n    }\n\n    this.scheduler.initialize(function () {\n      _this.update(resolvedState, initEvent);\n    });\n    return this;\n  };\n\n  Interpreter.prototype._stopChildren = function () {\n    // TODO: think about converting those to actions\n    this.children.forEach(function (child) {\n      if (isFunction(child.stop)) {\n        child.stop();\n      }\n    });\n    this.children.clear();\n  };\n\n  Interpreter.prototype._stop = function () {\n    var e_6, _a, e_7, _b, e_8, _c, e_9, _d, e_10, _e;\n\n    try {\n      for (var _f = __values(this.listeners), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var listener = _g.value;\n        this.listeners.delete(listener);\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    try {\n      for (var _h = __values(this.stopListeners), _j = _h.next(); !_j.done; _j = _h.next()) {\n        var listener = _j.value; // call listener, then remove\n\n        listener();\n        this.stopListeners.delete(listener);\n      }\n    } catch (e_7_1) {\n      e_7 = {\n        error: e_7_1\n      };\n    } finally {\n      try {\n        if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n      } finally {\n        if (e_7) throw e_7.error;\n      }\n    }\n\n    try {\n      for (var _k = __values(this.contextListeners), _l = _k.next(); !_l.done; _l = _k.next()) {\n        var listener = _l.value;\n        this.contextListeners.delete(listener);\n      }\n    } catch (e_8_1) {\n      e_8 = {\n        error: e_8_1\n      };\n    } finally {\n      try {\n        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n      } finally {\n        if (e_8) throw e_8.error;\n      }\n    }\n\n    try {\n      for (var _m = __values(this.doneListeners), _o = _m.next(); !_o.done; _o = _m.next()) {\n        var listener = _o.value;\n        this.doneListeners.delete(listener);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n\n    if (!this.initialized) {\n      // Interpreter already stopped; do nothing\n      return this;\n    }\n\n    this.initialized = false;\n    this.status = InterpreterStatus.Stopped;\n    this._initialState = undefined;\n\n    try {\n      // we are going to stop within the current sync frame\n      // so we can safely just cancel this here as nothing async should be fired anyway\n      for (var _p = __values(Object.keys(this.delayedEventsMap)), _q = _p.next(); !_q.done; _q = _p.next()) {\n        var key = _q.value;\n        this.clock.clearTimeout(this.delayedEventsMap[key]);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (_q && !_q.done && (_e = _p.return)) _e.call(_p);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    } // clear everything that might be enqueued\n\n\n    this.scheduler.clear();\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n  };\n  /**\r\n   * Stops the interpreter and unsubscribe all listeners.\r\n   *\r\n   * This will also notify the `onStop` listeners.\r\n   */\n\n\n  Interpreter.prototype.stop = function () {\n    // TODO: add warning for stopping non-root interpreters\n    var _this = this; // grab the current scheduler as it will be replaced in _stop\n\n\n    var scheduler = this.scheduler;\n\n    this._stop(); // let what is currently processed to be finished\n\n\n    scheduler.schedule(function () {\n      var _a;\n\n      if ((_a = _this._state) === null || _a === void 0 ? void 0 : _a.done) {\n        return;\n      } // it feels weird to handle this here but we need to handle this even slightly \"out of band\"\n\n\n      var _event = toSCXMLEvent({\n        type: 'xstate.stop'\n      });\n\n      var nextState = provide(_this, function () {\n        var exitActions = flatten(__spreadArray([], __read(_this.state.configuration), false).sort(function (a, b) {\n          return b.order - a.order;\n        }).map(function (stateNode) {\n          return toActionObjects(stateNode.onExit, _this.machine.options.actions);\n        }));\n\n        var _a = __read(resolveActions(_this.machine, _this.state, _this.state.context, _event, [{\n          type: 'exit',\n          actions: exitActions\n        }], _this.machine.config.predictableActionArguments ? _this._exec : undefined, _this.machine.config.predictableActionArguments || _this.machine.config.preserveActionOrder), 2),\n            resolvedActions = _a[0],\n            updatedContext = _a[1];\n\n        var newState = new State({\n          value: _this.state.value,\n          context: updatedContext,\n          _event: _event,\n          _sessionid: _this.sessionId,\n          historyValue: undefined,\n          history: _this.state,\n          actions: resolvedActions.filter(function (action) {\n            return !isRaisableAction(action);\n          }),\n          activities: {},\n          events: [],\n          configuration: [],\n          transitions: [],\n          children: {},\n          done: _this.state.done,\n          tags: _this.state.tags,\n          machine: _this.machine\n        });\n        newState.changed = true;\n        return newState;\n      });\n\n      _this.update(nextState, _event);\n\n      _this._stopChildren();\n\n      registry.free(_this.sessionId);\n    });\n    return this;\n  };\n\n  Interpreter.prototype.batch = function (events) {\n    var _this = this;\n\n    if (this.status === InterpreterStatus.NotStarted && this.options.deferEvents) {\n      // tslint:disable-next-line:no-console\n      if (!IS_PRODUCTION) {\n        warn(false, \"\".concat(events.length, \" event(s) were sent to uninitialized service \\\"\").concat(this.machine.id, \"\\\" and are deferred. Make sure .start() is called for this service.\\nEvent: \").concat(JSON.stringify(event)));\n      }\n    } else if (this.status !== InterpreterStatus.Running) {\n      throw new Error( // tslint:disable-next-line:max-line-length\n      \"\".concat(events.length, \" event(s) were sent to uninitialized service \\\"\").concat(this.machine.id, \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\"));\n    }\n\n    if (!events.length) {\n      return;\n    }\n\n    var exec = !!this.machine.config.predictableActionArguments && this._exec;\n    this.scheduler.schedule(function () {\n      var e_11, _a;\n\n      var nextState = _this.state;\n      var batchChanged = false;\n      var batchedActions = [];\n\n      var _loop_1 = function (event_1) {\n        var _event = toSCXMLEvent(event_1);\n\n        _this.forward(_event);\n\n        nextState = provide(_this, function () {\n          return _this.machine.transition(nextState, _event, undefined, exec || undefined);\n        });\n        batchedActions.push.apply(batchedActions, __spreadArray([], __read(_this.machine.config.predictableActionArguments ? nextState.actions : nextState.actions.map(function (a) {\n          return bindActionToState(a, nextState);\n        })), false));\n        batchChanged = batchChanged || !!nextState.changed;\n      };\n\n      try {\n        for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n          var event_1 = events_1_1.value;\n\n          _loop_1(event_1);\n        }\n      } catch (e_11_1) {\n        e_11 = {\n          error: e_11_1\n        };\n      } finally {\n        try {\n          if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n        } finally {\n          if (e_11) throw e_11.error;\n        }\n      }\n\n      nextState.changed = batchChanged;\n      nextState.actions = batchedActions;\n\n      _this.update(nextState, toSCXMLEvent(events[events.length - 1]));\n    });\n  };\n  /**\r\n   * Returns a send function bound to this interpreter instance.\r\n   *\r\n   * @param event The event to be sent by the sender.\r\n   */\n\n\n  Interpreter.prototype.sender = function (event) {\n    return this.send.bind(this, event);\n  };\n\n  Interpreter.prototype._nextState = function (event, exec) {\n    var _this = this;\n\n    if (exec === void 0) {\n      exec = !!this.machine.config.predictableActionArguments && this._exec;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    if (_event.name.indexOf(errorPlatform) === 0 && !this.state.nextEvents.some(function (nextEvent) {\n      return nextEvent.indexOf(errorPlatform) === 0;\n    })) {\n      throw _event.data.data;\n    }\n\n    var nextState = provide(this, function () {\n      return _this.machine.transition(_this.state, _event, undefined, exec || undefined);\n    });\n    return nextState;\n  };\n  /**\r\n   * Returns the next state given the interpreter's current state and the event.\r\n   *\r\n   * This is a pure method that does _not_ update the interpreter's state.\r\n   *\r\n   * @param event The event to determine the next state\r\n   */\n\n\n  Interpreter.prototype.nextState = function (event) {\n    return this._nextState(event, false);\n  };\n\n  Interpreter.prototype.forward = function (event) {\n    var e_12, _a;\n\n    try {\n      for (var _b = __values(this.forwardTo), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        var child = this.children.get(id);\n\n        if (!child) {\n          throw new Error(\"Unable to forward event '\".concat(event, \"' from interpreter '\").concat(this.id, \"' to nonexistant child '\").concat(id, \"'.\"));\n        }\n\n        child.send(event);\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.defer = function (sendAction) {\n    var _this = this;\n\n    var timerId = this.clock.setTimeout(function () {\n      if ('to' in sendAction && sendAction.to) {\n        _this.sendTo(sendAction._event, sendAction.to, true);\n      } else {\n        _this.send(sendAction._event);\n      }\n    }, sendAction.delay);\n\n    if (sendAction.id) {\n      this.delayedEventsMap[sendAction.id] = timerId;\n    }\n  };\n\n  Interpreter.prototype.cancel = function (sendId) {\n    this.clock.clearTimeout(this.delayedEventsMap[sendId]);\n    delete this.delayedEventsMap[sendId];\n  };\n\n  Interpreter.prototype.exec = function (action, state, actionFunctionMap) {\n    if (actionFunctionMap === void 0) {\n      actionFunctionMap = this.machine.options.actions;\n    }\n\n    this._exec(action, state.context, state._event, actionFunctionMap);\n  };\n\n  Interpreter.prototype.removeChild = function (childId) {\n    var _a;\n\n    this.children.delete(childId);\n    this.forwardTo.delete(childId); // this.state might not exist at the time this is called,\n    // such as when a child is added then removed while initializing the state\n\n    (_a = this.state) === null || _a === void 0 ? true : delete _a.children[childId];\n  };\n\n  Interpreter.prototype.stopChild = function (childId) {\n    var child = this.children.get(childId);\n\n    if (!child) {\n      return;\n    }\n\n    this.removeChild(childId);\n\n    if (isFunction(child.stop)) {\n      child.stop();\n    }\n  };\n\n  Interpreter.prototype.spawn = function (entity, name, options) {\n    if (this.status !== InterpreterStatus.Running) {\n      return createDeferredActor(entity, name);\n    }\n\n    if (isPromiseLike(entity)) {\n      return this.spawnPromise(Promise.resolve(entity), name);\n    } else if (isFunction(entity)) {\n      return this.spawnCallback(entity, name);\n    } else if (isSpawnedActor(entity)) {\n      return this.spawnActor(entity, name);\n    } else if (isObservable(entity)) {\n      return this.spawnObservable(entity, name);\n    } else if (isMachine(entity)) {\n      return this.spawnMachine(entity, __assign(__assign({}, options), {\n        id: name\n      }));\n    } else if (isBehavior(entity)) {\n      return this.spawnBehavior(entity, name);\n    } else {\n      throw new Error(\"Unable to spawn entity \\\"\".concat(name, \"\\\" of type \\\"\").concat(typeof entity, \"\\\".\"));\n    }\n  };\n\n  Interpreter.prototype.spawnMachine = function (machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var childService = new Interpreter(machine, __assign(__assign({}, this.options), {\n      parent: this,\n      id: options.id || machine.id\n    }));\n\n    var resolvedOptions = __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), options);\n\n    if (resolvedOptions.sync) {\n      childService.onTransition(function (state) {\n        _this.send(update, {\n          state: state,\n          id: childService.id\n        });\n      });\n    }\n\n    var actor = childService;\n    this.children.set(childService.id, actor);\n\n    if (resolvedOptions.autoForward) {\n      this.forwardTo.add(childService.id);\n    }\n\n    childService.onDone(function (doneEvent) {\n      _this.removeChild(childService.id);\n\n      _this.send(toSCXMLEvent(doneEvent, {\n        origin: childService.id\n      }));\n    }).start();\n    return actor;\n  };\n\n  Interpreter.prototype.spawnBehavior = function (behavior, id) {\n    var actorRef = spawnBehavior(behavior, {\n      id: id,\n      parent: this\n    });\n    this.children.set(id, actorRef);\n    return actorRef;\n  };\n\n  Interpreter.prototype.spawnPromise = function (promise, id) {\n    var _a;\n\n    var _this = this;\n\n    var canceled = false;\n    var resolvedData;\n    promise.then(function (response) {\n      if (!canceled) {\n        resolvedData = response;\n\n        _this.removeChild(id);\n\n        _this.send(toSCXMLEvent(doneInvoke(id, response), {\n          origin: id\n        }));\n      }\n    }, function (errorData) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        var errorEvent = error(id, errorData);\n\n        try {\n          // Send \"error.platform.id\" to this (parent).\n          _this.send(toSCXMLEvent(errorEvent, {\n            origin: id\n          }));\n        } catch (error) {\n          reportUnhandledExceptionOnInvocation(errorData, error, id);\n\n          if (_this.devTools) {\n            _this.devTools.send(errorEvent, _this.state);\n          }\n\n          if (_this.machine.strict) {\n            // it would be better to always stop the state machine if unhandled\n            // exception/promise rejection happens but because we don't want to\n            // break existing code so enforce it on strict mode only especially so\n            // because documentation says that onError is optional\n            _this.stop();\n          }\n        }\n      }\n    });\n    var actor = (_a = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        var observer = toObserver(next, handleError, complete);\n        var unsubscribed = false;\n        promise.then(function (response) {\n          if (unsubscribed) {\n            return;\n          }\n\n          observer.next(response);\n\n          if (unsubscribed) {\n            return;\n          }\n\n          observer.complete();\n        }, function (err) {\n          if (unsubscribed) {\n            return;\n          }\n\n          observer.error(err);\n        });\n        return {\n          unsubscribe: function () {\n            return unsubscribed = true;\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      },\n      getSnapshot: function () {\n        return resolvedData;\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a);\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnCallback = function (callback, id) {\n    var _a;\n\n    var _this = this;\n\n    var canceled = false;\n    var receivers = new Set();\n    var listeners = new Set();\n    var emitted;\n\n    var receive = function (e) {\n      emitted = e;\n      listeners.forEach(function (listener) {\n        return listener(e);\n      });\n\n      if (canceled) {\n        return;\n      }\n\n      _this.send(toSCXMLEvent(e, {\n        origin: id\n      }));\n    };\n\n    var callbackStop;\n\n    try {\n      callbackStop = callback(receive, function (newListener) {\n        receivers.add(newListener);\n      });\n    } catch (err) {\n      this.send(error(id, err));\n    }\n\n    if (isPromiseLike(callbackStop)) {\n      // it turned out to be an async function, can't reliably check this before calling `callback`\n      // because transpiled async functions are not recognizable\n      return this.spawnPromise(callbackStop, id);\n    }\n\n    var actor = (_a = {\n      id: id,\n      send: function (event) {\n        return receivers.forEach(function (receiver) {\n          return receiver(event);\n        });\n      },\n      subscribe: function (next) {\n        var observer = toObserver(next);\n        listeners.add(observer.next);\n        return {\n          unsubscribe: function () {\n            listeners.delete(observer.next);\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n\n        if (isFunction(callbackStop)) {\n          callbackStop();\n        }\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      },\n      getSnapshot: function () {\n        return emitted;\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a);\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnObservable = function (source, id) {\n    var _a;\n\n    var _this = this;\n\n    var emitted;\n    var subscription = source.subscribe(function (value) {\n      emitted = value;\n\n      _this.send(toSCXMLEvent(value, {\n        origin: id\n      }));\n    }, function (err) {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(error(id, err), {\n        origin: id\n      }));\n    }, function () {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(doneInvoke(id), {\n        origin: id\n      }));\n    });\n    var actor = (_a = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        return source.subscribe(next, handleError, complete);\n      },\n      stop: function () {\n        return subscription.unsubscribe();\n      },\n      getSnapshot: function () {\n        return emitted;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a);\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActor = function (actor, name) {\n    this.children.set(name, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActivity = function (activity) {\n    var implementation = this.machine.options && this.machine.options.activities ? this.machine.options.activities[activity.type] : undefined;\n\n    if (!implementation) {\n      if (!IS_PRODUCTION) {\n        warn(false, \"No implementation found for activity '\".concat(activity.type, \"'\"));\n      } // tslint:disable-next-line:no-console\n\n\n      return;\n    } // Start implementation\n\n\n    var dispose = implementation(this.state.context, activity);\n    this.spawnEffect(activity.id, dispose);\n  };\n\n  Interpreter.prototype.spawnEffect = function (id, dispose) {\n    var _a;\n\n    this.children.set(id, (_a = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function () {\n        return {\n          unsubscribe: function () {\n            return void 0;\n          }\n        };\n      },\n      stop: dispose || undefined,\n      getSnapshot: function () {\n        return undefined;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    }, _a[symbolObservable] = function () {\n      return this;\n    }, _a));\n  };\n\n  Interpreter.prototype.attachDev = function () {\n    var global = getGlobal();\n\n    if (this.options.devTools && global) {\n      if (global.__REDUX_DEVTOOLS_EXTENSION__) {\n        var devToolsOptions = typeof this.options.devTools === 'object' ? this.options.devTools : undefined;\n        this.devTools = global.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({\n          name: this.id,\n          autoPause: true,\n          stateSanitizer: function (state) {\n            return {\n              value: state.value,\n              context: state.context,\n              actions: state.actions\n            };\n          }\n        }, devToolsOptions), {\n          features: __assign({\n            jump: false,\n            skip: false\n          }, devToolsOptions ? devToolsOptions.features : undefined)\n        }), this.machine);\n        this.devTools.init(this.state);\n      } // add XState-specific dev tooling hook\n\n\n      registerService(this);\n    }\n  };\n\n  Interpreter.prototype.toJSON = function () {\n    return {\n      id: this.id\n    };\n  };\n\n  Interpreter.prototype[symbolObservable] = function () {\n    return this;\n  };\n\n  Interpreter.prototype.getSnapshot = function () {\n    if (this.status === InterpreterStatus.NotStarted) {\n      return this.initialState;\n    }\n\n    return this._state;\n  };\n  /**\r\n   * The default interpreter options:\r\n   *\r\n   * - `clock` uses the global `setTimeout` and `clearTimeout` functions\r\n   * - `logger` uses the global `console.log()` method\r\n   */\n\n\n  Interpreter.defaultOptions = {\n    execute: true,\n    deferEvents: true,\n    clock: {\n      setTimeout: function (fn, ms) {\n        return setTimeout(fn, ms);\n      },\n      clearTimeout: function (id) {\n        return clearTimeout(id);\n      }\n    },\n    logger: /*#__PURE__*/console.log.bind(console),\n    devTools: false\n  };\n  Interpreter.interpret = interpret;\n  return Interpreter;\n}();\n\nvar resolveSpawnOptions = function (nameOrOptions) {\n  if (isString(nameOrOptions)) {\n    return __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n      name: nameOrOptions\n    });\n  }\n\n  return __assign(__assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n    name: uniqueId()\n  }), nameOrOptions);\n};\n\nfunction spawn(entity, nameOrOptions) {\n  var resolvedOptions = resolveSpawnOptions(nameOrOptions);\n  return consume(function (service) {\n    if (!IS_PRODUCTION) {\n      var isLazyEntity = isMachine(entity) || isFunction(entity);\n      warn(!!service || isLazyEntity, \"Attempted to spawn an Actor (ID: \\\"\".concat(isMachine(entity) ? entity.id : 'undefined', \"\\\") outside of a service. This will have no effect.\"));\n    }\n\n    if (service) {\n      return service.spawn(entity, resolvedOptions.name, resolvedOptions);\n    } else {\n      return createDeferredActor(entity, resolvedOptions.name);\n    }\n  });\n}\n/**\r\n * Creates a new Interpreter instance for the given machine with the provided options, if any.\r\n *\r\n * @param machine The machine to interpret\r\n * @param options Interpreter options\r\n */\n\nfunction interpret(machine, options) {\n  var interpreter = new Interpreter(machine, options);\n  return interpreter;\n}\n\nexport { Interpreter, InterpreterStatus, interpret, spawn };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}