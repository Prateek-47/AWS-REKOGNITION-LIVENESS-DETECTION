{"ast":null,"code":"import _asyncToGenerator from \"D:/aws-rekognition-liveness-detection-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { EventStreamCodec } from \"@aws-sdk/eventstream-codec\";\nimport { getEventSigningTransformStream } from \"./get-event-signing-stream\";\nexport class EventStreamPayloadHandler {\n  constructor(options) {\n    this.messageSigner = options.messageSigner;\n    this.eventStreamCodec = new EventStreamCodec(options.utf8Encoder, options.utf8Decoder);\n  }\n\n  handle(next, args, context = {}) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const request = args.request;\n      const {\n        body: payload,\n        headers,\n        query\n      } = request;\n\n      if (!(payload instanceof ReadableStream)) {\n        throw new Error(\"Eventstream payload must be a ReadableStream.\");\n      }\n\n      const placeHolderStream = new TransformStream();\n      request.body = placeHolderStream.readable;\n      let result;\n\n      try {\n        result = yield next(args);\n      } catch (e) {\n        request.body.cancel();\n        throw e;\n      }\n\n      const match = (headers[\"authorization\"] || \"\").match(/Signature=([\\w]+)$/);\n      const priorSignature = (match || [])[1] || query && query[\"X-Amz-Signature\"] || \"\";\n      const signingStream = getEventSigningTransformStream(priorSignature, yield _this.messageSigner(), _this.eventStreamCodec);\n      const signedPayload = payload.pipeThrough(signingStream);\n      signedPayload.pipeThrough(placeHolderStream);\n      return result;\n    })();\n  }\n\n}","map":{"version":3,"names":["EventStreamCodec","getEventSigningTransformStream","EventStreamPayloadHandler","constructor","options","messageSigner","eventStreamCodec","utf8Encoder","utf8Decoder","handle","next","args","context","request","body","payload","headers","query","ReadableStream","Error","placeHolderStream","TransformStream","readable","result","e","cancel","match","priorSignature","signingStream","signedPayload","pipeThrough"],"sources":["D:/aws-rekognition-liveness-detection-main/node_modules/@aws-sdk/middleware-websocket/dist-es/EventStreamPayloadHandler.js"],"sourcesContent":["import { EventStreamCodec } from \"@aws-sdk/eventstream-codec\";\nimport { getEventSigningTransformStream } from \"./get-event-signing-stream\";\nexport class EventStreamPayloadHandler {\n    constructor(options) {\n        this.messageSigner = options.messageSigner;\n        this.eventStreamCodec = new EventStreamCodec(options.utf8Encoder, options.utf8Decoder);\n    }\n    async handle(next, args, context = {}) {\n        const request = args.request;\n        const { body: payload, headers, query } = request;\n        if (!(payload instanceof ReadableStream)) {\n            throw new Error(\"Eventstream payload must be a ReadableStream.\");\n        }\n        const placeHolderStream = new TransformStream();\n        request.body = placeHolderStream.readable;\n        let result;\n        try {\n            result = await next(args);\n        }\n        catch (e) {\n            request.body.cancel();\n            throw e;\n        }\n        const match = (headers[\"authorization\"] || \"\").match(/Signature=([\\w]+)$/);\n        const priorSignature = (match || [])[1] || (query && query[\"X-Amz-Signature\"]) || \"\";\n        const signingStream = getEventSigningTransformStream(priorSignature, await this.messageSigner(), this.eventStreamCodec);\n        const signedPayload = payload.pipeThrough(signingStream);\n        signedPayload.pipeThrough(placeHolderStream);\n        return result;\n    }\n}\n"],"mappings":";AAAA,SAASA,gBAAT,QAAiC,4BAAjC;AACA,SAASC,8BAAT,QAA+C,4BAA/C;AACA,OAAO,MAAMC,yBAAN,CAAgC;EACnCC,WAAW,CAACC,OAAD,EAAU;IACjB,KAAKC,aAAL,GAAqBD,OAAO,CAACC,aAA7B;IACA,KAAKC,gBAAL,GAAwB,IAAIN,gBAAJ,CAAqBI,OAAO,CAACG,WAA7B,EAA0CH,OAAO,CAACI,WAAlD,CAAxB;EACH;;EACKC,MAAM,CAACC,IAAD,EAAOC,IAAP,EAAaC,OAAO,GAAG,EAAvB,EAA2B;IAAA;;IAAA;MACnC,MAAMC,OAAO,GAAGF,IAAI,CAACE,OAArB;MACA,MAAM;QAAEC,IAAI,EAAEC,OAAR;QAAiBC,OAAjB;QAA0BC;MAA1B,IAAoCJ,OAA1C;;MACA,IAAI,EAAEE,OAAO,YAAYG,cAArB,CAAJ,EAA0C;QACtC,MAAM,IAAIC,KAAJ,CAAU,+CAAV,CAAN;MACH;;MACD,MAAMC,iBAAiB,GAAG,IAAIC,eAAJ,EAA1B;MACAR,OAAO,CAACC,IAAR,GAAeM,iBAAiB,CAACE,QAAjC;MACA,IAAIC,MAAJ;;MACA,IAAI;QACAA,MAAM,SAASb,IAAI,CAACC,IAAD,CAAnB;MACH,CAFD,CAGA,OAAOa,CAAP,EAAU;QACNX,OAAO,CAACC,IAAR,CAAaW,MAAb;QACA,MAAMD,CAAN;MACH;;MACD,MAAME,KAAK,GAAG,CAACV,OAAO,CAAC,eAAD,CAAP,IAA4B,EAA7B,EAAiCU,KAAjC,CAAuC,oBAAvC,CAAd;MACA,MAAMC,cAAc,GAAG,CAACD,KAAK,IAAI,EAAV,EAAc,CAAd,KAAqBT,KAAK,IAAIA,KAAK,CAAC,iBAAD,CAAnC,IAA2D,EAAlF;MACA,MAAMW,aAAa,GAAG3B,8BAA8B,CAAC0B,cAAD,QAAuB,KAAI,CAACtB,aAAL,EAAvB,EAA6C,KAAI,CAACC,gBAAlD,CAApD;MACA,MAAMuB,aAAa,GAAGd,OAAO,CAACe,WAAR,CAAoBF,aAApB,CAAtB;MACAC,aAAa,CAACC,WAAd,CAA0BV,iBAA1B;MACA,OAAOG,MAAP;IArBmC;EAsBtC;;AA3BkC"},"metadata":{},"sourceType":"module"}